<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DWC NEXUS Dashboard</title>
    
    <!-- Leaflet.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <!-- Leaflet.js JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <style>
        :root {
            --primary: #0066cc;
            --primary-light: #3399ff;
            --accent: #00ff88;
            --background: #f8fafc;
            --surface: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --gradient-primary: linear-gradient(135deg, #0066cc 0%, #3399ff 100%);
            --gradient-accent: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        [data-theme="dark"] {
            --background: #0f172a;
            --surface: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .dashboard-header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .header-left h1 {
            font-size: 1.5rem;
            font-weight: 600;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient-accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
        }

        .logout-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
        }

        .dashboard-layout {
            display: flex;
            height: calc(100vh - 80px);
        }

        .sidebar {
            width: 280px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 1.5rem;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 0.25rem;
        }

        .nav-item:hover {
            background: var(--background);
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
        }

        .nav-icon {
            font-size: 1.25rem;
            width: 24px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .module-view {
            display: none;
        }

        .module-view.active {
            display: block;
        }

        .module-header {
            margin-bottom: 2rem;
        }

        .module-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .module-subtitle {
            color: var(--text-secondary);
            font-size: 1.125rem;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .module-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: all 0.2s;
        }

        .module-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .card-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .card-status {
            font-size: 0.875rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-weight: 500;
        }

        .status-active { background: #dcfce7; color: #166534; }
        .status-processing { background: #dbeafe; color: #1d4ed8; }
        .status-idle { background: #f3f4f6; color: #374151; }

        .card-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .card-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .action-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.875rem;
            transition: transform 0.2s;
        }

        .action-btn:hover {
            transform: translateY(-1px);
        }

        .action-btn.secondary {
            background: var(--background);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* QNIS Lead Mapping Styles */
        .lead-mapping-interface {
            margin-top: 20px;
        }

        .map-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }

        .lead-counter {
            color: var(--accent);
            font-weight: 600;
            margin-left: auto;
        }

        .quantum-map-canvas {
            position: relative;
            width: 100%;
            height: 500px;
            border-radius: 15px;
            border: 2px solid var(--accent);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .map-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--accent);
            font-size: 18px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
        }

        .leaflet-map {
            width: 100%;
            height: 100%;
            border-radius: 13px;
        }

        .map-overlay-controls {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .map-control-select {
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--accent);
            border-radius: 6px;
            color: var(--accent);
            font-size: 12px;
            cursor: pointer;
        }

        .map-control-select:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 255, 136, 0.3);
        }

        /* Custom Leaflet marker styles */
        .lead-marker {
            background: transparent;
            border: none;
        }

        .lead-marker-content {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }

        .lead-marker-high {
            background: #ff4444;
        }

        .lead-marker-medium {
            background: #ffaa00;
        }

        .lead-marker-low {
            background: #00ff88;
        }

        .user-marker {
            background: #0099ff;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 3px 12px rgba(0, 153, 255, 0.6);
        }

        /* NLP Navigator Styles */
        .nlp-navigator {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .navigator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .navigator-header h4 {
            margin: 0;
            color: var(--accent);
            font-size: 16px;
            font-weight: 600;
        }

        .navigator-status {
            padding: 4px 8px;
            background: rgba(0, 255, 136, 0.2);
            color: var(--accent);
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .navigator-status.processing {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
        }

        .navigator-status.error {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }

        .navigator-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .nlp-input {
            flex: 1;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .nlp-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(0, 255, 136, 0.2);
        }

        .voice-btn {
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            color: var(--accent);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }

        .voice-btn:hover {
            background: rgba(0, 255, 136, 0.1);
        }

        .voice-btn.recording {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .nlp-results {
            margin-top: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            overflow: hidden;
        }

        .results-header {
            background: rgba(0, 255, 136, 0.1);
            padding: 10px 15px;
            color: var(--accent);
            font-weight: 600;
            font-size: 14px;
        }

        .results-content {
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-info {
            flex: 1;
        }

        .result-company {
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .result-details {
            color: var(--text-light);
            font-size: 12px;
        }

        .result-score {
            background: var(--primary);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .lead-stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }

        .stat-item .stat-label {
            color: var(--text-light);
            font-weight: 500;
        }

        .stat-item span:last-child {
            color: var(--accent);
            font-weight: 600;
            font-size: 16px;
        }

        /* Lead Drilldown Panel Styles */
        .lead-drilldown-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 350px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid var(--accent);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 100;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .drilldown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 255, 136, 0.1);
            border-bottom: 1px solid var(--accent);
            border-radius: 13px 13px 0 0;
        }

        .drilldown-header h3 {
            margin: 0;
            color: var(--accent);
            font-size: 18px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--accent);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .drilldown-content {
            padding: 20px;
        }

        .lead-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .info-label {
            color: var(--text-light);
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .qnis-score {
            color: var(--accent);
            font-weight: 700;
            font-size: 16px;
        }

        .lead-value {
            color: #4CAF50;
            font-weight: 700;
            font-size: 16px;
        }

        .priority-high {
            color: #ff4444;
            font-weight: 700;
        }

        .priority-medium {
            color: #ffaa00;
            font-weight: 700;
        }

        .priority-low {
            color: #4CAF50;
            font-weight: 700;
        }

        .lead-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-btn.primary {
            background: var(--primary);
            color: white;
        }

        .action-btn.accent {
            background: var(--accent);
            color: #000;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* API Key Management Styles */
        .api-key-management {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .key-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 25px;
        }

        .section-title {
            color: var(--accent);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .key-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            color: var(--text-light);
            font-weight: 500;
            font-size: 14px;
        }

        .form-input, .form-select {
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(0, 255, 136, 0.2);
        }

        .keys-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .key-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 10px;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr auto auto;
            align-items: center;
            gap: 15px;
        }

        .key-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .key-name {
            color: var(--accent);
            font-weight: 600;
            font-size: 16px;
        }

        .key-details {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: var(--text-light);
        }

        .key-scope {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
        }

        .key-value-display {
            font-family: 'Courier New', monospace;
            color: var(--text-light);
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            min-width: 200px;
        }

        .key-actions {
            display: flex;
            gap: 10px;
        }

        .key-btn {
            padding: 6px 12px;
            background: none;
            border: 1px solid var(--accent);
            color: var(--accent);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .key-btn:hover {
            background: var(--accent);
            color: #000;
        }

        .key-btn.danger {
            border-color: #ff4444;
            color: #ff4444;
        }

        .key-btn.danger:hover {
            background: #ff4444;
            color: white;
        }

        .loading-keys {
            text-align: center;
            color: var(--text-light);
            padding: 40px;
            font-style: italic;
        }

        .key-status {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 500;
        }

        .key-status.active {
            background: #4CAF50;
            color: white;
        }

        .key-status.expired {
            background: #ff4444;
            color: white;
        }

        .key-status.inactive {
            background: #666;
            color: white;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }

        @media (max-width: 768px) {
            .dashboard-layout { flex-direction: column; height: auto; }
            .sidebar { width: 100%; }
            .main-content { padding: 1rem; }
            .module-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="header-left">
            <h1>DWC NEXUS Dashboard</h1>
        </div>
        <div class="header-right">
            <button class="theme-toggle" onclick="toggleTheme()">🌙</button>
            <div class="user-info">
                <div class="user-avatar">DW</div>
                <span>Admin User</span>
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="dashboard-layout">
        <nav class="sidebar">
            <div class="nav-section">
                <div class="nav-title">Business Operations</div>
                <div class="nav-item active" onclick="showModule('business')">
                    <span class="nav-icon">💼</span>
                    <span>Business Suite</span>
                </div>
                <div class="nav-item" onclick="showModule('legal')">
                    <span class="nav-icon">⚖️</span>
                    <span>Legal Management</span>
                </div>
                <div class="nav-item" onclick="showModule('accounting')">
                    <span class="nav-icon">📊</span>
                    <span>Accounting</span>
                </div>
                <div class="nav-item" onclick="showModule('tax')">
                    <span class="nav-icon">🧾</span>
                    <span>Tax Management</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Intelligence & Analytics</div>
                <div class="nav-item" onclick="showModule('ai')">
                    <span class="nav-icon">🧠</span>
                    <span>AI & Watson</span>
                </div>
                <div class="nav-item" onclick="showModule('qnis')">
                    <span class="nav-icon">🗺️</span>
                    <span>QNIS Lead Map</span>
                </div>
                <div class="nav-item" onclick="showModule('leads')">
                    <span class="nav-icon">🎯</span>
                    <span>Lead Generation</span>
                </div>
                <div class="nav-item" onclick="showModule('analytics')">
                    <span class="nav-icon">📈</span>
                    <span>Analytics</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Automation</div>
                <div class="nav-item" onclick="showModule('workflow')">
                    <span class="nav-icon">⚙️</span>
                    <span>Workflows</span>
                </div>
                <div class="nav-item" onclick="showModule('voice')">
                    <span class="nav-icon">🎤</span>
                    <span>Voice Commands</span>
                </div>
                <div class="nav-item" onclick="showModule('trading')">
                    <span class="nav-icon">💹</span>
                    <span>Trading Bot</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">System</div>
                <div class="nav-item" onclick="showModule('admin')">
                    <span class="nav-icon">🛠️</span>
                    <span>Administration</span>
                </div>
                <div class="nav-item" onclick="showModule('apikeys')">
                    <span class="nav-icon">🔐</span>
                    <span>API Key Control</span>
                </div>
            </div>

            <!-- Business Operations Section -->
            <div class="nav-section">
                <div class="nav-title">Business Ops</div>
                <div class="nav-item" onclick="showModule('investor')">
                    <span class="nav-icon">📊</span>
                    <span>Investor Deck</span>
                </div>
                <div class="nav-item" onclick="showModule('pricing')">
                    <span class="nav-icon">💳</span>
                    <span>Pricing Plans</span>
                </div>
                <div class="nav-item" onclick="showModule('contact')">
                    <span class="nav-icon">✉️</span>
                    <span>Request for Info</span>
                </div>
                <div class="nav-item" onclick="showModule('cta')">
                    <span class="nav-icon">🚀</span>
                    <span>Call to Action</span>
                </div>
            </div>

            <!-- AI Assistants Section -->
            <div class="nav-section">
                <div class="nav-title">AI Assistants</div>
                <div class="nav-item" onclick="showModule('pitchgen')">
                    <span class="nav-icon">🧠</span>
                    <span>Pitch Generator</span>
                </div>
                <div class="nav-item" onclick="showModule('copybuilder')">
                    <span class="nav-icon">✍️</span>
                    <span>Site Copy Builder</span>
                </div>
                <div class="nav-item" onclick="showModule('research')">
                    <span class="nav-icon">🌍</span>
                    <span>Market Research</span>
                </div>
                <div class="nav-item" onclick="showModule('voicecommand')">
                    <span class="nav-icon">🎤</span>
                    <span>Voice Commands</span>
                </div>
                <div class="nav-item" onclick="showModule('scriptbuilder')">
                    <span class="nav-icon">📝</span>
                    <span>Script Builder</span>
                </div>
                <div class="nav-item" onclick="showModule('memory')">
                    <span class="nav-icon">🧠</span>
                    <span>Memory Trainer</span>
                </div>
                <div class="nav-item" onclick="showModule('watson')">
                    <span class="nav-icon">⚡</span>
                    <span>Watson AI</span>
                </div>
            </div>

            <!-- Developer/Settings Section -->
            <div class="nav-section">
                <div class="nav-title">Developer/Settings</div>
                <div class="nav-item" onclick="showModule('overview')">
                    <span class="nav-icon">📊</span>
                    <span>Live Dashboard</span>
                </div>
                <div class="nav-item" onclick="showModule('whitelabel')">
                    <span class="nav-icon">🎨</span>
                    <span>White Label Setup</span>
                </div>
                <div class="nav-item" onclick="showModule('emailcampaign')">
                    <span class="nav-icon">📧</span>
                    <span>Email Campaigns</span>
                </div>
                <div class="nav-item" onclick="showModule('logs')">
                    <span class="nav-icon">📋</span>
                    <span>System Logs</span>
                </div>
                <div class="nav-item" onclick="showModule('theme')">
                    <span class="nav-icon">🎨</span>
                    <span>Theme Customizer</span>
                </div>
                <div class="nav-item" onclick="showModule('moduleloader')">
                    <span class="nav-icon">🔌</span>
                    <span>Module Loader</span>
                </div>
                <div class="nav-item" onclick="showModule('apikeys')">
                    <span class="nav-icon">🔐</span>
                    <span>API Key Vault</span>
                </div>
            </div>
        </nav>

        <main class="main-content">
            <!-- Live Dashboard Overview Module -->
            <div id="overview-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">📊 Live Intelligence Dashboard</h2>
                    <p class="module-subtitle">Real-time business intelligence and performance metrics</p>
                </div>
                
                <div class="dashboard-grid">
                    <div class="dashboard-section metrics">
                        <h3>Key Performance Indicators</h3>
                        <div class="kpi-grid">
                            <div class="kpi-card">
                                <div class="kpi-icon">🎯</div>
                                <div class="kpi-value" id="total-leads">0</div>
                                <div class="kpi-label">Active Leads</div>
                                <div class="kpi-change positive" id="leads-change">+0%</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-icon">💰</div>
                                <div class="kpi-value" id="pipeline-value">$0</div>
                                <div class="kpi-label">Pipeline Value</div>
                                <div class="kpi-change positive" id="value-change">+0%</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-icon">📈</div>
                                <div class="kpi-value" id="conversion-rate">0%</div>
                                <div class="kpi-label">Conversion Rate</div>
                                <div class="kpi-change positive" id="conversion-change">+0%</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-icon">⚡</div>
                                <div class="kpi-value" id="ai-operations">0</div>
                                <div class="kpi-label">AI Operations</div>
                                <div class="kpi-change positive" id="ai-change">+0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-section activity-feed">
                        <h3>Live Activity Feed</h3>
                        <div id="activity-stream" class="activity-stream">
                            <div class="activity-item">
                                <div class="activity-icon">🚀</div>
                                <div class="activity-content">
                                    <div class="activity-title">DWC NEXUS Platform Initialized</div>
                                    <div class="activity-time">Just now</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-section quick-actions">
                        <h3>Quick Actions</h3>
                        <div class="action-grid">
                            <button class="quick-action-btn" onclick="showModule('qnis')">
                                <div class="action-icon">🗺️</div>
                                <div class="action-label">View Lead Map</div>
                            </button>
                            <button class="quick-action-btn" onclick="showModule('pitchgen')">
                                <div class="action-icon">🧠</div>
                                <div class="action-label">Generate Pitch</div>
                            </button>
                            <button class="quick-action-btn" onclick="showModule('research')">
                                <div class="action-icon">🌍</div>
                                <div class="action-label">Market Research</div>
                            </button>
                            <button class="quick-action-btn" onclick="showModule('watson')">
                                <div class="action-icon">⚡</div>
                                <div class="action-label">Watson AI</div>
                            </button>
                        </div>
                    </div>
                    
                    <div class="dashboard-section system-status">
                        <h3>System Status</h3>
                        <div class="status-grid">
                            <div class="status-item">
                                <div class="status-indicator active"></div>
                                <span>Lead Engine</span>
                                <span class="status-value">Active</span>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator active"></div>
                                <span>AI Pipeline</span>
                                <span class="status-value" id="ai-pipeline-status">Ready</span>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator active"></div>
                                <span>API Vault</span>
                                <span class="status-value" id="api-vault-status">Connected</span>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator active"></div>
                                <span>Voice Commands</span>
                                <span class="status-value">Available</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- QNIS Lead Mapping Module -->
            <div id="qnis-module" class="module-view">
                <div class="module-header">
                    <h2 class="module-title">QNIS Quantum Lead Mapping</h2>
                    <p class="module-subtitle">Real-time lead generation with dynamic coordinate tracking</p>
                </div>
                
                <div class="lead-mapping-interface">
                    <div class="map-controls">
                        <button id="refresh-map" class="action-btn">Refresh Map</button>
                        <button id="locate-user" class="action-btn">📍 Locate Me</button>
                        <button id="clear-leads" class="action-btn secondary" onclick="clearLeadData()">Clear Leads</button>
                        <span id="lead-counter" class="lead-counter">Leads: 0</span>
                    </div>

                    <!-- NLP Lead Navigator -->
                    <div class="nlp-navigator">
                        <div class="navigator-header">
                            <h4>AI Lead Navigator</h4>
                            <span class="navigator-status" id="nlp-status">Ready</span>
                        </div>
                        <div class="navigator-input">
                            <input type="text" id="nlp-query" placeholder="Ask me: 'Show tech leads in California over $50k' or 'Find legal contacts near Dallas'" class="nlp-input">
                            <button id="voice-query" class="voice-btn" title="Voice Query">🎤</button>
                            <button id="execute-query" class="action-btn primary">Search</button>
                        </div>
                        <div id="nlp-results" class="nlp-results" style="display: none;">
                            <div class="results-header">Search Results</div>
                            <div id="results-content" class="results-content"></div>
                        </div>
                    </div>
                    
                    <div id="quantum-map-canvas" class="quantum-map-canvas">
                        <div class="map-loading">Initializing Geographic Intelligence Map...</div>
                        <div id="lead-map" class="leaflet-map"></div>
                        
                        <!-- Map Controls Overlay -->
                        <div class="map-overlay-controls">
                            <select id="map-layer-select" class="map-control-select">
                                <option value="street">Street View</option>
                                <option value="satellite">Satellite</option>
                                <option value="terrain">Terrain</option>
                            </select>
                            <select id="jump-to-city" class="map-control-select">
                                <option value="">Jump to City...</option>
                                <option value="40.7589,-73.9851">New York</option>
                                <option value="34.0522,-118.2437">Los Angeles</option>
                                <option value="41.8781,-87.6298">Chicago</option>
                                <option value="29.7604,-95.3698">Houston</option>
                                <option value="37.7749,-122.4194">San Francisco</option>
                                <option value="25.7617,-80.1918">Miami</option>
                                <option value="32.7767,-96.7970">Dallas</option>
                            </select>
                        </div>
                        
                        <!-- Lead Drilldown Panel -->
                        <div id="lead-drilldown" class="lead-drilldown-panel" style="display: none;">
                            <div class="drilldown-header">
                                <h3 id="lead-company-name">Company Name</h3>
                                <button id="close-drilldown" class="close-btn">×</button>
                            </div>
                            <div class="drilldown-content">
                                <div class="lead-info-grid">
                                    <div class="info-item">
                                        <span class="info-label">Industry:</span>
                                        <span id="lead-industry">Technology</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Type:</span>
                                        <span id="lead-type">Enterprise</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">QNIS Score:</span>
                                        <span id="lead-qnis-score" class="qnis-score">94</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Est. Value:</span>
                                        <span id="lead-value" class="lead-value">$45K</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Source:</span>
                                        <span id="lead-source">LinkedIn</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Priority:</span>
                                        <span id="lead-priority" class="priority-high">HIGH</span>
                                    </div>
                                </div>
                                
                                <div class="lead-actions">
                                    <button id="generate-website" class="action-btn primary">Generate Website</button>
                                    <button id="scrape-legacy" class="action-btn secondary">Scrape Legacy Site</button>
                                    <button id="sync-crm" class="action-btn accent">Sync to CRM</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="lead-stats-panel">
                        <div class="stat-item">
                            <span class="stat-label">High Priority:</span>
                            <span id="high-priority-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Avg QNIS Score:</span>
                            <span id="avg-qnis-score">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Value:</span>
                            <span id="total-lead-value">$0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Business Operations Modules -->
            
            <!-- Investor Deck Module -->
            <div id="investor-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">📊 DWC Systems - Investor Deck</h2>
                    <p class="module-subtitle">Enterprise-grade intelligence platform with proven ROI metrics</p>
                </div>
                
                <div class="business-content">
                    <div class="pitch-deck-container">
                        <div class="deck-section">
                            <div class="deck-slide">
                                <h3>Market Opportunity</h3>
                                <div class="metric-grid">
                                    <div class="metric-card">
                                        <div class="metric-value">$847B</div>
                                        <div class="metric-label">Global B2B SaaS Market</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-value">23.8%</div>
                                        <div class="metric-label">Annual Growth Rate</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-value">89%</div>
                                        <div class="metric-label">Businesses Need Lead Intelligence</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="deck-section">
                            <div class="deck-slide">
                                <h3>DWC Platform Advantage</h3>
                                <div class="advantage-list">
                                    <div class="advantage-item">
                                        <span class="advantage-icon">🧠</span>
                                        <div>
                                            <strong>Quantum Intelligence Scoring (QNIS)</strong>
                                            <p>Proprietary AI-driven lead qualification system with 94% accuracy</p>
                                        </div>
                                    </div>
                                    <div class="advantage-item">
                                        <span class="advantage-icon">🗺️</span>
                                        <div>
                                            <strong>Geographic Lead Mapping</strong>
                                            <p>Real-time coordinate tracking with intelligent market analysis</p>
                                        </div>
                                    </div>
                                    <div class="advantage-item">
                                        <span class="advantage-icon">⚡</span>
                                        <div>
                                            <strong>Autonomous Pipeline</strong>
                                            <p>Zero-touch lead processing from discovery to outreach</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="deck-section">
                            <div class="deck-slide">
                                <h3>Financial Projections</h3>
                                <div class="projection-table">
                                    <table class="financial-table">
                                        <thead>
                                            <tr>
                                                <th>Year</th>
                                                <th>ARR</th>
                                                <th>Customers</th>
                                                <th>Market Share</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>2025</td>
                                                <td>$2.4M</td>
                                                <td>850</td>
                                                <td>0.1%</td>
                                            </tr>
                                            <tr>
                                                <td>2026</td>
                                                <td>$8.7M</td>
                                                <td>2,400</td>
                                                <td>0.3%</td>
                                            </tr>
                                            <tr>
                                                <td>2027</td>
                                                <td>$24.1M</td>
                                                <td>6,200</td>
                                                <td>0.8%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pricing Plans Module -->
            <div id="pricing-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">💳 Pricing Plans</h2>
                    <p class="module-subtitle">Flexible plans designed to scale with your business needs</p>
                </div>
                
                <div class="business-content">
                    <div class="pricing-grid">
                        <div class="pricing-card starter">
                            <div class="pricing-header">
                                <h4>Solo</h4>
                                <div class="price">
                                    <span class="currency">$</span>
                                    <span class="amount">97</span>
                                    <span class="period">/month</span>
                                </div>
                                <p class="pricing-description">Perfect for individual entrepreneurs</p>
                            </div>
                            <div class="pricing-features">
                                <div class="feature">✓ Up to 500 leads/month</div>
                                <div class="feature">✓ Basic QNIS scoring</div>
                                <div class="feature">✓ Geographic mapping</div>
                                <div class="feature">✓ Email support</div>
                                <div class="feature">✓ Standard automation</div>
                            </div>
                            <button class="pricing-btn">Start Solo Plan</button>
                        </div>
                        
                        <div class="pricing-card professional recommended">
                            <div class="pricing-badge">Most Popular</div>
                            <div class="pricing-header">
                                <h4>Pro</h4>
                                <div class="price">
                                    <span class="currency">$</span>
                                    <span class="amount">297</span>
                                    <span class="period">/month</span>
                                </div>
                                <p class="pricing-description">Advanced features for growing businesses</p>
                            </div>
                            <div class="pricing-features">
                                <div class="feature">✓ Up to 2,500 leads/month</div>
                                <div class="feature">✓ Advanced QNIS analytics</div>
                                <div class="feature">✓ NLP lead navigator</div>
                                <div class="feature">✓ Voice commands</div>
                                <div class="feature">✓ Priority support</div>
                                <div class="feature">✓ Custom integrations</div>
                            </div>
                            <button class="pricing-btn primary">Start Pro Plan</button>
                        </div>
                        
                        <div class="pricing-card enterprise">
                            <div class="pricing-header">
                                <h4>Agency</h4>
                                <div class="price">
                                    <span class="currency">$</span>
                                    <span class="amount">897</span>
                                    <span class="period">/month</span>
                                </div>
                                <p class="pricing-description">Complete solution for agencies</p>
                            </div>
                            <div class="pricing-features">
                                <div class="feature">✓ Up to 10,000 leads/month</div>
                                <div class="feature">✓ Multi-client management</div>
                                <div class="feature">✓ White-label interface</div>
                                <div class="feature">✓ Autonomous pipeline</div>
                                <div class="feature">✓ Dedicated account manager</div>
                                <div class="feature">✓ Custom reporting</div>
                            </div>
                            <button class="pricing-btn">Start Agency Plan</button>
                        </div>
                        
                        <div class="pricing-card enterprise">
                            <div class="pricing-header">
                                <h4>Enterprise</h4>
                                <div class="price">
                                    <span class="text">Custom</span>
                                </div>
                                <p class="pricing-description">Tailored solutions for large organizations</p>
                            </div>
                            <div class="pricing-features">
                                <div class="feature">✓ Unlimited leads</div>
                                <div class="feature">✓ Custom AI models</div>
                                <div class="feature">✓ On-premise deployment</div>
                                <div class="feature">✓ 24/7 support</div>
                                <div class="feature">✓ SLA guarantees</div>
                                <div class="feature">✓ Custom development</div>
                            </div>
                            <button class="pricing-btn">Contact Sales</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact/Request for Info Module -->
            <div id="contact-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">✉️ Request for Information</h2>
                    <p class="module-subtitle">Get in touch with our team for detailed information</p>
                </div>
                
                <div class="business-content">
                    <div class="contact-form-container">
                        <form id="contact-form" class="contact-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="contact-name">Full Name *</label>
                                    <input type="text" id="contact-name" name="name" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label for="contact-email">Email Address *</label>
                                    <input type="email" id="contact-email" name="email" class="form-input" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="contact-company">Company Name</label>
                                    <input type="text" id="contact-company" name="company" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label for="contact-role">Role/Title</label>
                                    <input type="text" id="contact-role" name="role" class="form-input">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="contact-interest">Interest Area</label>
                                <select id="contact-interest" name="interest" class="form-select">
                                    <option value="">Select your primary interest...</option>
                                    <option value="lead-generation">Lead Generation & QNIS</option>
                                    <option value="automation">Autonomous Pipeline</option>
                                    <option value="integration">API & Integrations</option>
                                    <option value="enterprise">Enterprise Solutions</option>
                                    <option value="partnership">Partnership Opportunities</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="contact-message">Message</label>
                                <textarea id="contact-message" name="message" class="form-input" rows="5" placeholder="Tell us about your needs, current challenges, or specific questions..."></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="action-btn primary">Send Request</button>
                                <button type="button" class="action-btn secondary" onclick="clearContactForm()">Clear Form</button>
                            </div>
                        </form>
                        
                        <div class="contact-info">
                            <div class="contact-method">
                                <span class="contact-icon">📧</span>
                                <div>
                                    <strong>Email</strong>
                                    <p>info@dwcsystems.com</p>
                                </div>
                            </div>
                            <div class="contact-method">
                                <span class="contact-icon">📞</span>
                                <div>
                                    <strong>Phone</strong>
                                    <p>+1 (555) 123-4567</p>
                                </div>
                            </div>
                            <div class="contact-method">
                                <span class="contact-icon">🌐</span>
                                <div>
                                    <strong>Website</strong>
                                    <p>dwcsystems.com</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- White Label Setup Module -->
            <div id="whitelabel-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">🎨 White Label Setup</h2>
                    <p class="module-subtitle">Customize branding, theme, and domain configuration</p>
                </div>
                
                <div class="business-content">
                    <div class="whitelabel-interface">
                        <div class="branding-section">
                            <h3>Brand Configuration</h3>
                            <div class="branding-grid">
                                <div class="brand-item">
                                    <label for="brand-name">Company Name</label>
                                    <input type="text" id="brand-name" class="form-input" value="DWC Systems" placeholder="Your Company Name">
                                </div>
                                <div class="brand-item">
                                    <label for="brand-tagline">Tagline</label>
                                    <input type="text" id="brand-tagline" class="form-input" value="Intelligence Platform" placeholder="Your tagline">
                                </div>
                                <div class="brand-item">
                                    <label for="brand-domain">Custom Domain</label>
                                    <input type="text" id="brand-domain" class="form-input" placeholder="yourdomain.com">
                                </div>
                                <div class="brand-item">
                                    <label for="support-email">Support Email</label>
                                    <input type="email" id="support-email" class="form-input" placeholder="support@yourdomain.com">
                                </div>
                            </div>
                        </div>
                        
                        <div class="theme-section">
                            <h3>Theme Customization</h3>
                            <div class="theme-controls">
                                <div class="color-group">
                                    <label>Primary Color</label>
                                    <div class="color-picker-group">
                                        <input type="color" id="primary-color" value="#00ff88">
                                        <input type="text" id="primary-hex" class="color-input" value="#00ff88">
                                    </div>
                                </div>
                                <div class="color-group">
                                    <label>Background Color</label>
                                    <div class="color-picker-group">
                                        <input type="color" id="bg-color" value="#0a0e1a">
                                        <input type="text" id="bg-hex" class="color-input" value="#0a0e1a">
                                    </div>
                                </div>
                                <div class="color-group">
                                    <label>Text Color</label>
                                    <div class="color-picker-group">
                                        <input type="color" id="text-color" value="#ffffff">
                                        <input type="text" id="text-hex" class="color-input" value="#ffffff">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="theme-presets">
                                <h4>Quick Presets</h4>
                                <div class="preset-grid">
                                    <button class="preset-btn" data-theme="dwc">DWC Original</button>
                                    <button class="preset-btn" data-theme="corporate">Corporate Blue</button>
                                    <button class="preset-btn" data-theme="elegant">Elegant Purple</button>
                                    <button class="preset-btn" data-theme="modern">Modern Green</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="logo-section">
                            <h3>Logo & Assets</h3>
                            <div class="logo-upload">
                                <div class="upload-area" id="logo-upload">
                                    <div class="upload-content">
                                        <div class="upload-icon">📤</div>
                                        <div class="upload-text">Click to upload logo or drag & drop</div>
                                        <div class="upload-specs">PNG, JPG up to 2MB</div>
                                    </div>
                                </div>
                                <div class="logo-preview" id="logo-preview" style="display: none;">
                                    <img id="logo-image" src="" alt="Logo Preview">
                                    <button class="remove-logo">Remove</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preview-section">
                            <h3>Live Preview</h3>
                            <div class="preview-frame">
                                <div class="preview-header" id="preview-header">
                                    <h2 id="preview-title">DWC NEXUS</h2>
                                    <div id="preview-subtitle">Intelligence Platform</div>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-card">
                                        <h4>Sample Module</h4>
                                        <p>This is how your customized theme will look across the platform.</p>
                                        <button class="preview-btn">Sample Button</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="whitelabel-actions">
                            <button id="apply-branding" class="action-btn primary">Apply Branding</button>
                            <button id="export-theme" class="action-btn secondary">Export Theme</button>
                            <button id="reset-branding" class="action-btn secondary">Reset to Default</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Email Campaign Builder Module -->
            <div id="emailcampaign-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">📧 Email Campaign Builder</h2>
                    <p class="module-subtitle">AI-powered email campaigns with dynamic template editor</p>
                </div>
                
                <div class="business-content">
                    <div class="email-builder-interface">
                        <div class="campaign-setup">
                            <h3>Campaign Configuration</h3>
                            <div class="campaign-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="campaign-name">Campaign Name</label>
                                        <input type="text" id="campaign-name" class="form-input" placeholder="Q4 Lead Nurture Campaign">
                                    </div>
                                    <div class="form-group">
                                        <label for="campaign-type">Campaign Type</label>
                                        <select id="campaign-type" class="form-select">
                                            <option value="nurture">Lead Nurture</option>
                                            <option value="onboarding">Customer Onboarding</option>
                                            <option value="promotional">Promotional</option>
                                            <option value="reengagement">Re-engagement</option>
                                            <option value="newsletter">Newsletter</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="target-audience">Target Audience</label>
                                    <select id="target-audience" class="form-select">
                                        <option value="all-leads">All Active Leads</option>
                                        <option value="high-value">High-Value Prospects (QNIS 80+)</option>
                                        <option value="warm-leads">Warm Leads</option>
                                        <option value="cold-leads">Cold Leads</option>
                                        <option value="custom">Custom Segment</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="template-editor">
                            <h3>Email Template</h3>
                            <div class="template-tabs">
                                <button class="template-tab active" data-tab="design">Visual Designer</button>
                                <button class="template-tab" data-tab="code">HTML Code</button>
                                <button class="template-tab" data-tab="preview">Preview</button>
                            </div>
                            
                            <div class="template-content">
                                <div id="design-editor" class="editor-panel active">
                                    <div class="editor-toolbar">
                                        <button class="tool-btn" data-tool="header">📄 Header</button>
                                        <button class="tool-btn" data-tool="text">📝 Text Block</button>
                                        <button class="tool-btn" data-tool="button">🔲 Button</button>
                                        <button class="tool-btn" data-tool="image">🖼️ Image</button>
                                        <button class="tool-btn" data-tool="divider">➖ Divider</button>
                                    </div>
                                    
                                    <div class="email-canvas" id="email-canvas">
                                        <div class="email-header">
                                            <h2 contenteditable="true">Subject: Transform Your Business with AI Intelligence</h2>
                                        </div>
                                        <div class="email-body">
                                            <div class="content-block" contenteditable="true">
                                                <p>Hi {{firstName}},</p>
                                                <p>Your recent activity on our platform shows strong engagement with {{topFeature}}. Based on your QNIS score of {{qnisScore}}, you're an ideal candidate for our advanced features.</p>
                                                <p>Here's what we recommend for your {{industry}} business:</p>
                                            </div>
                                            <div class="cta-block">
                                                <button class="email-cta" contenteditable="true">Schedule Your Demo</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="code-editor" class="editor-panel">
                                    <textarea id="html-code" class="code-editor">
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{subject}}</title>
</head>
<body>
    <div style="max-width: 600px; margin: 0 auto; font-family: Arial, sans-serif;">
        <h2>Hi {{firstName}},</h2>
        <p>Your QNIS score of {{qnisScore}} indicates high potential...</p>
        <a href="{{ctaLink}}" style="background: #00ff88; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px;">Schedule Demo</a>
    </div>
</body>
</html>
                                    </textarea>
                                </div>
                                
                                <div id="preview-panel" class="editor-panel">
                                    <div class="preview-device">
                                        <div class="device-frame desktop">
                                            <iframe id="email-preview" src="about:blank"></iframe>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ai-enhancement">
                            <h3>AI Enhancement</h3>
                            <div class="ai-tools">
                                <button id="optimize-subject" class="ai-tool-btn">🧠 Optimize Subject Line</button>
                                <button id="personalize-content" class="ai-tool-btn">👤 Personalize Content</button>
                                <button id="improve-cta" class="ai-tool-btn">🎯 Improve CTA</button>
                                <button id="a-b-test" class="ai-tool-btn">🔬 Generate A/B Variants</button>
                            </div>
                        </div>
                        
                        <div class="campaign-actions">
                            <button id="save-template" class="action-btn secondary">Save Template</button>
                            <button id="test-send" class="action-btn secondary">Send Test</button>
                            <button id="schedule-campaign" class="action-btn primary">Schedule Campaign</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Call to Action Module -->
            <div id="cta-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">🚀 Take Action</h2>
                    <p class="module-subtitle">Ready to transform your lead generation process?</p>
                </div>
                
                <div class="business-content">
                    <div class="cta-grid">
                        <div class="cta-card primary">
                            <div class="cta-icon">📅</div>
                            <h3>Book a Demo</h3>
                            <p>See DWC Systems in action with a personalized 30-minute demonstration of our quantum intelligence platform.</p>
                            <button class="cta-btn primary" onclick="scheduleDemo()">Schedule Demo</button>
                            <div class="cta-features">
                                <span>✓ Live QNIS demonstration</span>
                                <span>✓ Custom use case review</span>
                                <span>✓ ROI analysis</span>
                            </div>
                        </div>
                        
                        <div class="cta-card secondary">
                            <div class="cta-icon">🔧</div>
                            <h3>Start AI Fix</h3>
                            <p>Let our autonomous pipeline analyze and improve your current lead generation process in real-time.</p>
                            <button class="cta-btn secondary" onclick="startAIFix()">Start AI Analysis</button>
                            <div class="cta-features">
                                <span>✓ Instant lead audit</span>
                                <span>✓ Improvement recommendations</span>
                                <span>✓ Custom solution preview</span>
                            </div>
                        </div>
                        
                        <div class="cta-card tertiary">
                            <div class="cta-icon">📋</div>
                            <h3>Download Audit</h3>
                            <p>Get a comprehensive analysis of your current lead generation capabilities and improvement opportunities.</p>
                            <button class="cta-btn tertiary" onclick="downloadAudit()">Download Report</button>
                            <div class="cta-features">
                                <span>✓ Executive summary</span>
                                <span>✓ Technical analysis</span>
                                <span>✓ Implementation roadmap</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="urgency-banner">
                        <div class="urgency-content">
                            <span class="urgency-icon">⚡</span>
                            <div class="urgency-text">
                                <strong>Limited Time Offer:</strong> 
                                Get 3 months free with annual Pro or Agency plan signup before month end.
                            </div>
                            <button class="urgency-btn" onclick="claimOffer()">Claim Offer</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Assistants Modules -->
            
            <!-- Pitch Generator Module -->
            <div id="pitchgen-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">🧠 AI Pitch Generator</h2>
                    <p class="module-subtitle">Generate compelling investor pitches and business proposals using GPT</p>
                </div>
                
                <div class="ai-assistant-container">
                    <div class="ai-status-bar">
                        <div class="ai-status-item">
                            <span class="status-label">API Status:</span>
                            <span id="pitch-api-status" class="status-indicator">Checking...</span>
                        </div>
                        <div class="ai-status-item">
                            <span class="status-label">Model:</span>
                            <span class="status-value">GPT-4</span>
                        </div>
                    </div>
                    
                    <div class="ai-input-section">
                        <div class="form-group">
                            <label for="pitch-type">Pitch Type</label>
                            <select id="pitch-type" class="form-select">
                                <option value="investor">Investor Deck</option>
                                <option value="sales">Sales Presentation</option>
                                <option value="partnership">Partnership Proposal</option>
                                <option value="product">Product Launch</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="pitch-company">Company/Product Name</label>
                            <input type="text" id="pitch-company" class="form-input" placeholder="DWC Systems">
                        </div>
                        
                        <div class="form-group">
                            <label for="pitch-industry">Industry</label>
                            <input type="text" id="pitch-industry" class="form-input" placeholder="B2B SaaS Intelligence">
                        </div>
                        
                        <div class="form-group">
                            <label for="pitch-details">Key Details & Requirements</label>
                            <textarea id="pitch-details" class="form-input" rows="4" placeholder="Describe your unique value proposition, target market, key metrics, funding goals, or specific requirements..."></textarea>
                        </div>
                        
                        <div class="ai-actions">
                            <button id="generate-pitch" class="action-btn primary">Generate Pitch</button>
                            <button id="clear-pitch" class="action-btn secondary">Clear</button>
                        </div>
                    </div>
                    
                    <div class="ai-output-section">
                        <div class="output-header">
                            <h4>Generated Pitch</h4>
                            <div class="output-actions">
                                <button id="copy-pitch" class="action-btn secondary">Copy</button>
                                <button id="export-pitch" class="action-btn secondary">Export</button>
                            </div>
                        </div>
                        <div id="pitch-output" class="ai-output">
                            Click "Generate Pitch" to create a compelling presentation based on your inputs.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Site Copy Builder Module -->
            <div id="copybuilder-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">✍️ AI Site Copy Builder</h2>
                    <p class="module-subtitle">Create professional website copy and marketing content with GPT</p>
                </div>
                
                <div class="ai-assistant-container">
                    <div class="ai-status-bar">
                        <div class="ai-status-item">
                            <span class="status-label">API Status:</span>
                            <span id="copy-api-status" class="status-indicator">Checking...</span>
                        </div>
                        <div class="ai-status-item">
                            <span class="status-label">Model:</span>
                            <span class="status-value">GPT-4</span>
                        </div>
                    </div>
                    
                    <div class="ai-input-section">
                        <div class="form-group">
                            <label for="copy-type">Content Type</label>
                            <select id="copy-type" class="form-select">
                                <option value="homepage">Homepage Hero</option>
                                <option value="about">About Page</option>
                                <option value="services">Services Description</option>
                                <option value="landing">Landing Page</option>
                                <option value="email">Email Campaign</option>
                                <option value="social">Social Media Posts</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="copy-business">Business Name</label>
                            <input type="text" id="copy-business" class="form-input" placeholder="Your business name">
                        </div>
                        
                        <div class="form-group">
                            <label for="copy-audience">Target Audience</label>
                            <input type="text" id="copy-audience" class="form-input" placeholder="Enterprise clients, SMBs, startups...">
                        </div>
                        
                        <div class="form-group">
                            <label for="copy-tone">Tone & Style</label>
                            <select id="copy-tone" class="form-select">
                                <option value="professional">Professional</option>
                                <option value="friendly">Friendly & Approachable</option>
                                <option value="authoritative">Authoritative</option>
                                <option value="casual">Casual</option>
                                <option value="technical">Technical</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="copy-details">Additional Context</label>
                            <textarea id="copy-details" class="form-input" rows="3" placeholder="Unique selling points, specific features to highlight, call-to-action goals..."></textarea>
                        </div>
                        
                        <div class="ai-actions">
                            <button id="generate-copy" class="action-btn primary">Generate Copy</button>
                            <button id="clear-copy" class="action-btn secondary">Clear</button>
                        </div>
                    </div>
                    
                    <div class="ai-output-section">
                        <div class="output-header">
                            <h4>Generated Copy</h4>
                            <div class="output-actions">
                                <button id="copy-copy" class="action-btn secondary">Copy</button>
                                <button id="refine-copy" class="action-btn secondary">Refine</button>
                            </div>
                        </div>
                        <div id="copy-output" class="ai-output">
                            Click "Generate Copy" to create professional website content based on your specifications.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Market Research Agent Module -->
            <div id="research-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">🌍 AI Market Research Agent</h2>
                    <p class="module-subtitle">Real-time market intelligence and competitive analysis using Perplexity AI</p>
                </div>
                
                <div class="ai-assistant-container">
                    <div class="ai-status-bar">
                        <div class="ai-status-item">
                            <span class="status-label">API Status:</span>
                            <span id="research-api-status" class="status-indicator">Checking...</span>
                        </div>
                        <div class="ai-status-item">
                            <span class="status-label">Model:</span>
                            <span class="status-value">Perplexity Sonar</span>
                        </div>
                    </div>
                    
                    <div class="ai-input-section">
                        <div class="form-group">
                            <label for="research-type">Research Type</label>
                            <select id="research-type" class="form-select">
                                <option value="market">Market Analysis</option>
                                <option value="competitor">Competitor Research</option>
                                <option value="industry">Industry Trends</option>
                                <option value="pricing">Pricing Analysis</option>
                                <option value="opportunities">Market Opportunities</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="research-query">Research Query</label>
                            <textarea id="research-query" class="form-input" rows="3" placeholder="e.g., 'Latest trends in B2B SaaS lead generation tools 2024' or 'Top competitors to HubSpot in small business market'"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="research-timeframe">Timeframe</label>
                            <select id="research-timeframe" class="form-select">
                                <option value="month">Past Month</option>
                                <option value="quarter">Past Quarter</option>
                                <option value="year">Past Year</option>
                                <option value="all">All Time</option>
                            </select>
                        </div>
                        
                        <div class="ai-actions">
                            <button id="start-research" class="action-btn primary">Start Research</button>
                            <button id="clear-research" class="action-btn secondary">Clear</button>
                        </div>
                    </div>
                    
                    <div class="ai-output-section">
                        <div class="output-header">
                            <h4>Research Results</h4>
                            <div class="output-actions">
                                <button id="copy-research" class="action-btn secondary">Copy</button>
                                <button id="export-research" class="action-btn secondary">Export Report</button>
                            </div>
                        </div>
                        <div id="research-output" class="ai-output">
                            Enter your research query and click "Start Research" to get real-time market intelligence.
                        </div>
                        <div id="research-sources" class="research-sources" style="display: none;">
                            <h5>Sources:</h5>
                            <div id="sources-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Voice Command Center Module -->
            <div id="voicecommand-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">🎤 Voice Command Center</h2>
                    <p class="module-subtitle">Control all AI assistants and platform functions through voice commands</p>
                </div>
                
                <div class="ai-assistant-container">
                    <div class="voice-status-section">
                        <div class="voice-visualizer">
                            <div class="voice-icon">🎤</div>
                            <div id="voice-status" class="voice-status">Ready to listen</div>
                        </div>
                        
                        <div class="voice-controls">
                            <button id="start-listening" class="voice-btn primary">Start Listening</button>
                            <button id="stop-listening" class="voice-btn secondary" disabled>Stop</button>
                        </div>
                    </div>
                    
                    <div class="voice-commands-grid">
                        <div class="command-category">
                            <h4>Navigation Commands</h4>
                            <div class="command-examples">
                                <span class="command">"Show QNIS map"</span>
                                <span class="command">"Open investor deck"</span>
                                <span class="command">"Go to pricing"</span>
                            </div>
                        </div>
                        
                        <div class="command-category">
                            <h4>AI Assistant Commands</h4>
                            <div class="command-examples">
                                <span class="command">"Generate pitch for SaaS company"</span>
                                <span class="command">"Research competitors in my industry"</span>
                                <span class="command">"Create copy for homepage"</span>
                            </div>
                        </div>
                        
                        <div class="command-category">
                            <h4>Lead Commands</h4>
                            <div class="command-examples">
                                <span class="command">"Find leads in California"</span>
                                <span class="command">"Show tech companies over 50K"</span>
                                <span class="command">"Process lead with AI"</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="voice-output-section">
                        <div class="output-header">
                            <h4>Command History</h4>
                            <button id="clear-history" class="action-btn secondary">Clear</button>
                        </div>
                        <div id="voice-history" class="voice-history">
                            Voice commands will appear here...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Smart Script Builder Module -->
            <div id="scriptbuilder-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">📝 Smart Script Builder</h2>
                    <p class="module-subtitle">AI-powered script generation with website logic integration</p>
                </div>
                
                <div class="ai-assistant-container">
                    <div class="ai-status-bar">
                        <div class="ai-status-item">
                            <span class="status-label">API Status:</span>
                            <span id="script-api-status" class="status-indicator">Checking...</span>
                        </div>
                        <div class="ai-status-item">
                            <span class="status-label">Model:</span>
                            <span class="status-value">GPT-4 + Logic Engine</span>
                        </div>
                    </div>
                    
                    <div class="script-builder-interface">
                        <div class="script-config-section">
                            <div class="form-group">
                                <label for="script-type">Script Type</label>
                                <select id="script-type" class="form-select">
                                    <option value="sales-call">Sales Call Script</option>
                                    <option value="demo-presentation">Demo Presentation</option>
                                    <option value="objection-handling">Objection Handling</option>
                                    <option value="followup-sequence">Follow-up Sequence</option>
                                    <option value="onboarding-flow">Onboarding Flow</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="script-industry">Target Industry</label>
                                    <input type="text" id="script-industry" class="form-input" placeholder="B2B SaaS, Healthcare, Finance...">
                                </div>
                                <div class="form-group">
                                    <label for="script-persona">Buyer Persona</label>
                                    <input type="text" id="script-persona" class="form-input" placeholder="CTO, Marketing Director, CEO...">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="script-objectives">Key Objectives</label>
                                <textarea id="script-objectives" class="form-input" rows="3" placeholder="What specific outcomes do you want to achieve with this script?"></textarea>
                            </div>
                            
                            <div class="script-logic-section">
                                <h4>Website Logic Integration</h4>
                                <div class="logic-options">
                                    <label class="logic-toggle">
                                        <input type="checkbox" id="include-lead-data">
                                        <span>Include Lead Data Context</span>
                                    </label>
                                    <label class="logic-toggle">
                                        <input type="checkbox" id="include-qnis-score">
                                        <span>Reference QNIS Score</span>
                                    </label>
                                    <label class="logic-toggle">
                                        <input type="checkbox" id="include-website-audit">
                                        <span>Include Website Audit Results</span>
                                    </label>
                                    <label class="logic-toggle">
                                        <input type="checkbox" id="dynamic-pricing">
                                        <span>Dynamic Pricing References</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="ai-actions">
                                <button id="generate-script" class="action-btn primary">Generate Script</button>
                                <button id="clear-script-form" class="action-btn secondary">Clear</button>
                            </div>
                        </div>
                        
                        <div class="script-output-section">
                            <div class="output-header">
                                <h4>Generated Script</h4>
                                <div class="output-actions">
                                    <button id="copy-script" class="action-btn secondary">Copy</button>
                                    <button id="export-script" class="action-btn secondary">Export</button>
                                    <button id="test-script" class="action-btn secondary">Test Flow</button>
                                </div>
                            </div>
                            <div id="script-output" class="ai-output">
                                Configure your script parameters and click "Generate Script" to create intelligent, context-aware scripts.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Memory Trainer Module -->
            <div id="memory-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">🧠 Memory Trainer</h2>
                    <p class="module-subtitle">Conversation-based AI reinforcement learning system</p>
                </div>
                
                <div class="ai-assistant-container">
                    <div class="memory-interface">
                        <div class="memory-stats">
                            <div class="memory-stat">
                                <div class="stat-value" id="total-conversations">0</div>
                                <div class="stat-label">Conversations</div>
                            </div>
                            <div class="memory-stat">
                                <div class="stat-value" id="knowledge-nodes">0</div>
                                <div class="stat-label">Knowledge Nodes</div>
                            </div>
                            <div class="memory-stat">
                                <div class="stat-value" id="accuracy-score">0%</div>
                                <div class="stat-label">Accuracy</div>
                            </div>
                        </div>
                        
                        <div class="conversation-trainer">
                            <div class="trainer-input-section">
                                <div class="form-group">
                                    <label for="training-context">Training Context</label>
                                    <select id="training-context" class="form-select">
                                        <option value="lead-qualification">Lead Qualification</option>
                                        <option value="product-knowledge">Product Knowledge</option>
                                        <option value="objection-handling">Objection Handling</option>
                                        <option value="pricing-strategy">Pricing Strategy</option>
                                        <option value="competitor-analysis">Competitor Analysis</option>
                                    </select>
                                </div>
                                
                                <div class="conversation-input">
                                    <textarea id="conversation-input" class="form-input conversation-area" placeholder="Enter a conversation scenario or question to train the AI..."></textarea>
                                </div>
                                
                                <div class="trainer-actions">
                                    <button id="train-memory" class="action-btn primary">Train Memory</button>
                                    <button id="test-knowledge" class="action-btn secondary">Test Knowledge</button>
                                    <button id="export-memory" class="action-btn secondary">Export Model</button>
                                </div>
                            </div>
                            
                            <div class="memory-response-section">
                                <div class="output-header">
                                    <h4>AI Response & Learning</h4>
                                    <div class="output-actions">
                                        <button id="approve-response" class="action-btn success">✓ Approve</button>
                                        <button id="correct-response" class="action-btn warning">✏️ Correct</button>
                                    </div>
                                </div>
                                <div id="memory-response" class="ai-output">
                                    Start a training conversation to begin building AI memory patterns.
                                </div>
                            </div>
                        </div>
                        
                        <div class="knowledge-graph">
                            <h4>Knowledge Graph</h4>
                            <div id="knowledge-visualization" class="knowledge-viz">
                                <div class="knowledge-node" data-type="core">
                                    <div class="node-label">DWC Platform</div>
                                    <div class="node-connections">3</div>
                                </div>
                                <div class="knowledge-node" data-type="feature">
                                    <div class="node-label">QNIS Mapping</div>
                                    <div class="node-connections">5</div>
                                </div>
                                <div class="knowledge-node" data-type="benefit">
                                    <div class="node-label">Lead Intelligence</div>
                                    <div class="node-connections">2</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Watson AI Module -->
            <div id="watson-module" class="module-view" style="display: none;">
                <div class="module-header">
                    <h2 class="module-title">⚡ Watson AI Command Center</h2>
                    <p class="module-subtitle">Advanced AI orchestration and autonomous decision making</p>
                </div>
                
                <div class="ai-assistant-container">
                    <div class="watson-dashboard">
                        <div class="watson-status-grid">
                            <div class="watson-metric">
                                <div class="metric-label">Active Pipelines</div>
                                <div class="metric-value" id="watson-pipelines">0</div>
                            </div>
                            <div class="watson-metric">
                                <div class="metric-label">AI Operations</div>
                                <div class="metric-value" id="watson-operations">Ready</div>
                            </div>
                            <div class="watson-metric">
                                <div class="metric-label">Learning Mode</div>
                                <div class="metric-value" id="watson-learning">Active</div>
                            </div>
                        </div>
                        
                        <div class="watson-controls">
                            <div class="watson-section">
                                <h4>Autonomous Operations</h4>
                                <div class="watson-toggles">
                                    <label class="watson-toggle">
                                        <input type="checkbox" id="auto-lead-processing">
                                        <span>Auto Lead Processing</span>
                                    </label>
                                    <label class="watson-toggle">
                                        <input type="checkbox" id="auto-content-generation">
                                        <span>Auto Content Generation</span>
                                    </label>
                                    <label class="watson-toggle">
                                        <input type="checkbox" id="auto-research">
                                        <span>Auto Market Research</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="watson-section">
                                <h4>Direct Command Interface</h4>
                                <div class="watson-command-input">
                                    <input type="text" id="watson-command" class="form-input" placeholder="Enter Watson command...">
                                    <button id="execute-watson" class="action-btn primary">Execute</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="watson-log">
                            <div class="output-header">
                                <h4>Watson Activity Log</h4>
                                <button id="clear-watson-log" class="action-btn secondary">Clear</button>
                            </div>
                            <div id="watson-activity" class="watson-activity-log">
                                Watson AI system initialized and ready for autonomous operations...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Key Management Module -->
            <div id="apikeys-module" class="module-view">
                <div class="module-header">
                    <h2 class="module-title">API Key Control Center</h2>
                    <p class="module-subtitle">Secure credential management with enterprise-grade encryption</p>
                </div>
                
                <div class="api-key-management">
                    <!-- Add New API Key Section -->
                    <div class="key-section">
                        <h3 class="section-title">Add New API Key</h3>
                        <div class="key-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="key-name">Key Name</label>
                                    <input type="text" id="key-name" placeholder="e.g., OpenAI Production Key" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label for="key-scope">Scope</label>
                                    <select id="key-scope" class="form-select">
                                        <option value="mapping">Mapping</option>
                                        <option value="crm">CRM</option>
                                        <option value="ai">AI</option>
                                        <option value="scraper">Scraper</option>
                                        <option value="all">All Access</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="key-value">API Key Value</label>
                                    <input type="password" id="key-value" placeholder="Enter API key value" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label for="key-expiry">Expiration (Optional)</label>
                                    <input type="date" id="key-expiry" class="form-input">
                                </div>
                            </div>
                            <button id="add-key-btn" class="action-btn primary">Add API Key</button>
                        </div>
                    </div>

                    <!-- Existing Keys Section -->
                    <div class="key-section">
                        <h3 class="section-title">Existing API Keys</h3>
                        <div id="keys-list" class="keys-list">
                            <div class="loading-keys">Loading API keys...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Business Suite Module -->
            <div id="business-module" class="module-view active">
                <div class="module-header">
                    <h2 class="module-title">Business Operations Suite</h2>
                    <p class="module-subtitle">Comprehensive business management and automation tools</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="active-modules">0</div>
                        <div class="stat-label">Active Modules</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="system-uptime">0%</div>
                        <div class="stat-label">System Uptime</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="cash-balance">$0</div>
                        <div class="stat-label">Cash Balance</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="ai-accuracy">0%</div>
                        <div class="stat-label">AI Accuracy</div>
                    </div>
                </div>

                <div class="module-grid">
                    <div class="module-card">
                        <div class="card-icon">⚖️</div>
                        <div class="card-title">Legal Management</div>
                        <div class="card-status status-active">Active</div>
                        <div class="card-description">Contract management, compliance tracking, and legal document automation for LLC operations.</div>
                        <div class="card-actions">
                            <button class="action-btn" onclick="openModule('legal')">Manage Contracts</button>
                            <button class="action-btn secondary">Compliance</button>
                        </div>
                    </div>

                    <div class="module-card">
                        <div class="card-icon">📊</div>
                        <div class="card-title">Accounting System</div>
                        <div class="card-status status-processing">Processing</div>
                        <div class="card-description">Full double-entry bookkeeping, financial statements, and automated accounting workflows.</div>
                        <div class="card-actions">
                            <button class="action-btn" onclick="openModule('accounting')">Journal Entries</button>
                            <button class="action-btn secondary">Reports</button>
                        </div>
                    </div>

                    <div class="module-card">
                        <div class="card-icon">🧾</div>
                        <div class="card-title">Tax Management</div>
                        <div class="card-status status-active">Current</div>
                        <div class="card-description">Tax preparation, quarterly filings, deduction tracking, and compliance automation.</div>
                        <div class="card-actions">
                            <button class="action-btn" onclick="openModule('tax')">File Returns</button>
                            <button class="action-btn secondary">Deductions</button>
                        </div>
                    </div>

                    <div class="module-card">
                        <div class="card-icon">💰</div>
                        <div class="card-title">Payroll System</div>
                        <div class="card-status status-active">Active</div>
                        <div class="card-description">Employee payroll processing, tax withholdings, and benefits administration.</div>
                        <div class="card-actions">
                            <button class="action-btn">Process Payroll</button>
                            <button class="action-btn secondary">Tax Forms</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Legal Module -->
            <div id="legal-module" class="module-view">
                <div class="module-header">
                    <h2 class="module-title">Legal Management Suite</h2>
                    <p class="module-subtitle">Contract management and compliance automation</p>
                </div>

                <div class="module-grid">
                    <div class="module-card">
                        <div class="card-title">Contract Management</div>
                        <div class="card-description">
                            <strong>Active Contracts:</strong> <span id="active-contracts">0</span> agreements<br>
                            <strong>Pending Review:</strong> <span id="pending-contracts">0</span> contracts<br>
                            <strong>Expiring Soon:</strong> <span id="expiring-contracts">0</span> within 30 days
                        </div>
                        <div class="card-actions">
                            <button class="action-btn">Generate Contract</button>
                            <button class="action-btn secondary">View All</button>
                        </div>
                    </div>

                    <div class="module-card">
                        <div class="card-title">Document Generator</div>
                        <div class="card-description">
                            <select style="width: 100%; padding: 0.5rem; margin: 0.5rem 0; border: 1px solid var(--border); border-radius: 0.25rem;">
                                <option>Non-Disclosure Agreement</option>
                                <option>Service Agreement</option>
                                <option>Employment Contract</option>
                                <option>Operating Agreement</option>
                            </select>
                            <input type="text" placeholder="Client/Party name" style="width: 100%; padding: 0.5rem; margin: 0.5rem 0; border: 1px solid var(--border); border-radius: 0.25rem;">
                        </div>
                        <div class="card-actions">
                            <button class="action-btn">Generate Document</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accounting Module -->
            <div id="accounting-module" class="module-view">
                <div class="module-header">
                    <h2 class="module-title">Accounting Management</h2>
                    <p class="module-subtitle">Financial management and reporting system</p>
                </div>

                <div class="module-grid">
                    <div class="module-card">
                        <div class="card-title">Financial Summary</div>
                        <div class="card-description">
                            <strong>Cash Balance:</strong> $<span id="cash-balance-detail">0.00</span><br>
                            <strong>Monthly Revenue:</strong> $<span id="monthly-revenue">0.00</span><br>
                            <strong>Net Profit:</strong> <span id="net-profit">0.0%</span>
                        </div>
                        <div class="card-actions">
                            <button class="action-btn">View Details</button>
                        </div>
                    </div>

                    <div class="module-card">
                        <div class="card-title">Journal Entry</div>
                        <div class="card-description">
                            <input type="date" style="width: 100%; padding: 0.5rem; margin: 0.25rem 0; border: 1px solid var(--border); border-radius: 0.25rem;">
                            <input type="text" placeholder="Description" style="width: 100%; padding: 0.5rem; margin: 0.25rem 0; border: 1px solid var(--border); border-radius: 0.25rem;">
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="number" placeholder="Debit" style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 0.25rem;">
                                <input type="number" placeholder="Credit" style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 0.25rem;">
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="action-btn">Post Entry</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add other modules here following the same pattern -->
            
        </main>
    </div>

    <script>
        function showModule(moduleId) {
            // Hide all module views
            document.querySelectorAll('.module-view').forEach(view => {
                view.classList.remove('active');
            });
            
            // Show selected module
            const targetModule = document.getElementById(moduleId + '-module');
            if (targetModule) {
                targetModule.classList.add('active');
            }
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
        }

        function openModule(moduleId) {
            showModule(moduleId);
        }

        function toggleTheme() {
            const body = document.body;
            const themeBtn = document.querySelector('.theme-toggle');
            
            if (body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                themeBtn.textContent = '🌙';
            } else {
                body.setAttribute('data-theme', 'dark');
                themeBtn.textContent = '☀️';
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '/';
            }
        }

        // Voice command integration
        function initializeVoiceCommands() {
            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = false;
                
                recognition.onresult = function(event) {
                    const command = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
                    processVoiceCommand(command);
                };
                
                recognition.start();
            }
        }

        function processVoiceCommand(command) {
            switch(command) {
                case 'show business':
                    showModule('business');
                    break;
                case 'show legal':
                    showModule('legal');
                    break;
                case 'show accounting':
                    showModule('accounting');
                    break;
                case 'logout':
                    logout();
                    break;
            }
        }

        // QNIS Geographic Lead Mapping Engine
        let qnisMap = {
            map: null,
            leads: [],
            isInitialized: false,
            userLocation: null,
            selectedLead: null,
            leadMarkers: [],
            userMarker: null,
            routeLines: [],
            mapLayers: {
                street: null,
                satellite: null,
                terrain: null
            }
        };

        // KaizenGPT Command Interface
        window.kaizen_command = async function(command, params = {}) {
            try {
                const response = await fetch('/api/kaizen/command', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ command, params })
                });
                
                const result = await response.json();
                console.log('[KAIZEN] Command executed:', result);
                
                if (result.success) {
                    // Handle specific command responses
                    if (command === 'generate_map') {
                        updateQuantumMap(result.result);
                    } else if (command === 'reset_all_modules') {
                        resetDashboardData();
                    }
                    return result.result;
                } else {
                    console.error('[KAIZEN] Command failed:', result.error);
                    return { error: result.error };
                }
            } catch (error) {
                console.error('[KAIZEN] Command error:', error);
                return { error: error.message };
            }
        };

        function initializeQuantumMap() {
            const mapContainer = document.getElementById('lead-map');
            if (!mapContainer) return;

            // Initialize Leaflet map
            qnisMap.map = L.map('lead-map', {
                center: [39.8283, -98.5795], // Geographic center of USA
                zoom: 4,
                zoomControl: true,
                attributionControl: false
            });

            // Initialize map layers
            initializeMapLayers();
            
            // Hide loading message
            const loading = document.querySelector('.map-loading');
            if (loading) loading.style.display = 'none';

            qnisMap.isInitialized = true;

            // Start real-time lead fetching
            startLeadTracking();
            
            // Initialize map controls
            initializeMapControls();
            
            console.log('[QNIS] Geographic intelligence map initialized');
        }

        function initializeMapLayers() {
            // Street layer (OpenStreetMap)
            qnisMap.mapLayers.street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 18
            });

            // Satellite layer (requires API key from vault)
            qnisMap.mapLayers.satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '© Esri',
                maxZoom: 17
            });

            // Terrain layer
            qnisMap.mapLayers.terrain = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenTopoMap contributors',
                maxZoom: 15
            });

            // Add default street layer
            qnisMap.mapLayers.street.addTo(qnisMap.map);
        }

        function initializeMapControls() {
            // Layer switcher
            const layerSelect = document.getElementById('map-layer-select');
            if (layerSelect) {
                layerSelect.addEventListener('change', (e) => {
                    switchMapLayer(e.target.value);
                });
            }

            // City jump selector
            const citySelect = document.getElementById('jump-to-city');
            if (citySelect) {
                citySelect.addEventListener('change', (e) => {
                    if (e.target.value) {
                        const [lat, lng] = e.target.value.split(',').map(Number);
                        qnisMap.map.setView([lat, lng], 10);
                        e.target.value = ''; // Reset selector
                    }
                });
            }
        }

        function switchMapLayer(layerType) {
            // Remove current layer
            Object.values(qnisMap.mapLayers).forEach(layer => {
                if (qnisMap.map.hasLayer(layer)) {
                    qnisMap.map.removeLayer(layer);
                }
            });

            // Add selected layer
            if (qnisMap.mapLayers[layerType]) {
                qnisMap.mapLayers[layerType].addTo(qnisMap.map);
            }
        }

        async function startLeadTracking() {
            // Initial load
            await updateLeadData();
            
            // Update every 5 seconds
            setInterval(updateLeadData, 5000);
        }

        async function updateLeadData() {
            try {
                const response = await fetch('/api/qnis/leads');
                const leads = await response.json();
                
                qnisMap.leads = leads;
                renderQuantumMap();
                updateLeadStats();
                
                // Update lead counter
                const counter = document.getElementById('lead-counter');
                if (counter) counter.textContent = `Leads: ${leads.length}`;
                
            } catch (error) {
                console.error('[QNIS] Failed to fetch leads:', error);
            }
        }

        function renderQuantumMap() {
            if (!qnisMap.isInitialized || !qnisMap.map) return;

            // Clear existing markers
            clearMapMarkers();

            // Plot lead markers
            qnisMap.leads.forEach((lead) => {
                createLeadMarker(lead);
            });

            // Add user location marker if available
            if (qnisMap.userLocation) {
                createUserMarker();
            }

            // Draw route lines between user and leads
            if (qnisMap.userLocation && qnisMap.leads.length > 0) {
                drawRouteLines();
            }
        }

        function clearMapMarkers() {
            // Remove existing lead markers
            qnisMap.leadMarkers.forEach(marker => {
                qnisMap.map.removeLayer(marker);
            });
            qnisMap.leadMarkers = [];

            // Remove user marker
            if (qnisMap.userMarker) {
                qnisMap.map.removeLayer(qnisMap.userMarker);
                qnisMap.userMarker = null;
            }

            // Remove route lines
            qnisMap.routeLines.forEach(line => {
                qnisMap.map.removeLayer(line);
            });
            qnisMap.routeLines = [];
        }

        function createLeadMarker(lead) {
            const priorityClass = `lead-marker-${lead.priority.toLowerCase()}`;
            
            // Create custom marker icon
            const markerIcon = L.divIcon({
                className: 'lead-marker',
                html: `<div class="lead-marker-content ${priorityClass}">${lead.qnis_score}</div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });

            // Create marker
            const marker = L.marker([lead.coordinates.lat, lead.coordinates.lng], {
                icon: markerIcon,
                leadId: lead.id  // Store lead ID for NLP filtering
            });

            // Add popup with lead information
            const popupContent = `
                <div style="font-family: Arial, sans-serif; min-width: 200px;">
                    <h4 style="margin: 0 0 10px 0; color: #00ff88;">${lead.coordinates.city} Lead</h4>
                    <p style="margin: 5px 0;"><strong>Industry:</strong> ${lead.industry}</p>
                    <p style="margin: 5px 0;"><strong>Type:</strong> ${lead.type}</p>
                    <p style="margin: 5px 0;"><strong>QNIS Score:</strong> ${lead.qnis_score}</p>
                    <p style="margin: 5px 0;"><strong>Value:</strong> $${Math.floor(lead.value_estimate / 1000)}K</p>
                    <p style="margin: 5px 0;"><strong>Priority:</strong> <span style="color: ${getPriorityColor(lead.priority)}">${lead.priority}</span></p>
                    <button onclick="showLeadDrilldown(qnisMap.leads.find(l => l.id === '${lead.id}'))" 
                            style="background: #00ff88; color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
                        View Details
                    </button>
                </div>
            `;

            marker.bindPopup(popupContent);

            // Add click handler for detailed view
            marker.on('click', () => {
                showLeadDrilldown(lead);
            });

            // Add to map and tracking array
            marker.addTo(qnisMap.map);
            qnisMap.leadMarkers.push(marker);
        }

        function createUserMarker() {
            const userIcon = L.divIcon({
                className: 'user-marker',
                html: '📍',
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });

            qnisMap.userMarker = L.marker([qnisMap.userLocation.lat, qnisMap.userLocation.lng], {
                icon: userIcon
            });

            qnisMap.userMarker.bindPopup(`
                <div style="font-family: Arial, sans-serif;">
                    <h4 style="margin: 0 0 10px 0; color: #0099ff;">Your Location</h4>
                    <p style="margin: 5px 0;"><strong>City:</strong> ${qnisMap.userLocation.city || 'Unknown'}</p>
                    <p style="margin: 5px 0;"><strong>Source:</strong> ${qnisMap.userLocation.source || 'GPS'}</p>
                </div>
            `);

            qnisMap.userMarker.addTo(qnisMap.map);
        }

        function drawRouteLines() {
            // Draw lines from user to top 3 priority leads
            const sortedLeads = qnisMap.leads
                .filter(lead => lead.priority === 'HIGH')
                .slice(0, 3);

            sortedLeads.forEach((lead, index) => {
                const routeLine = L.polyline([
                    [qnisMap.userLocation.lat, qnisMap.userLocation.lng],
                    [lead.coordinates.lat, lead.coordinates.lng]
                ], {
                    color: getPriorityColor(lead.priority),
                    weight: 2,
                    opacity: 0.6,
                    dashArray: index === 0 ? null : '5, 10' // Solid line for first, dashed for others
                });

                routeLine.addTo(qnisMap.map);
                qnisMap.routeLines.push(routeLine);
            });
        }

        function getPriorityColor(priority) {
            switch (priority) {
                case 'HIGH': return '#ff4444';
                case 'MEDIUM': return '#ffaa00';
                case 'LOW': return '#00ff88';
                default: return '#00ff88';
            }
        }

        function drawUSMapOutline(ctx) {
            // Simplified US border outline
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 2;
            ctx.globalAlpha = 0.3;

            ctx.beginPath();
            // West coast
            ctx.moveTo(50, 300);
            ctx.lineTo(80, 100);
            ctx.lineTo(120, 80);
            
            // North border
            ctx.lineTo(700, 80);
            
            // East coast
            ctx.lineTo(720, 300);
            ctx.lineTo(680, 350);
            
            // South border
            ctx.lineTo(200, 370);
            ctx.lineTo(100, 350);
            ctx.closePath();
            
            ctx.stroke();
            ctx.globalAlpha = 1.0;
        }

        function drawLeadConnections(ctx) {
            if (qnisMap.leads.length < 2) return;

            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 1;
            ctx.globalAlpha = 0.2;

            for (let i = 1; i < Math.min(qnisMap.leads.length, 10); i++) {
                const current = latLngToCanvas(qnisMap.leads[i].coordinates.lat, qnisMap.leads[i].coordinates.lng);
                const previous = latLngToCanvas(qnisMap.leads[i-1].coordinates.lat, qnisMap.leads[i-1].coordinates.lng);

                ctx.beginPath();
                ctx.moveTo(previous.x, previous.y);
                ctx.lineTo(current.x, current.y);
                ctx.stroke();
            }

            ctx.globalAlpha = 1.0;
        }

        function drawUserLocation(ctx) {
            const userPos = latLngToCanvas(qnisMap.userLocation.lat, qnisMap.userLocation.lng);
            
            ctx.save();
            
            // User location marker - distinct blue color
            ctx.fillStyle = '#0099ff';
            ctx.shadowColor = '#0099ff';
            ctx.shadowBlur = 15;
            
            // Animated pulsing ring
            const pulse = Math.sin(Date.now() / 200) * 0.5 + 0.5;
            const ringRadius = 15 + (pulse * 8);
            
            // Outer ring
            ctx.globalAlpha = 0.3;
            ctx.beginPath();
            ctx.arc(userPos.x, userPos.y, ringRadius, 0, Math.PI * 2);
            ctx.fill();
            
            // Inner dot
            ctx.globalAlpha = 1;
            ctx.beginPath();
            ctx.arc(userPos.x, userPos.y, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // User label
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('You', userPos.x + 15, userPos.y - 10);
            
            ctx.restore();
        }

        async function getUserLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    // Fallback to IP geolocation
                    getLocationByIP().then(resolve).catch(reject);
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve({
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            source: 'GPS'
                        });
                    },
                    (error) => {
                        console.log('[LOCATION] GPS failed, trying IP geolocation');
                        getLocationByIP().then(resolve).catch(reject);
                    },
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 300000 }
                );
            });
        }

        async function getLocationByIP() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                return {
                    lat: data.latitude,
                    lng: data.longitude,
                    city: data.city,
                    source: 'IP'
                };
            } catch (error) {
                throw new Error('Location detection failed');
            }
        }

        function handleCanvasClick(event) {
            const rect = qnisMap.canvas.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const clickY = event.clientY - rect.top;

            // Check if click hits any lead
            for (const lead of qnisMap.leads) {
                if (lead._canvasData) {
                    const distance = Math.sqrt(
                        Math.pow(clickX - lead._canvasData.x, 2) + 
                        Math.pow(clickY - lead._canvasData.y, 2)
                    );
                    
                    if (distance <= lead._canvasData.radius) {
                        showLeadDrilldown(lead);
                        return;
                    }
                }
            }
        }

        function showLeadDrilldown(lead) {
            qnisMap.selectedLead = lead;
            
            // Generate realistic company data
            const companyNames = [
                `${lead.coordinates.city} Tech Solutions`,
                `${lead.industry} Dynamics Corp`,
                `${lead.coordinates.city} ${lead.industry} Group`,
                `Quantum ${lead.industry} Systems`,
                `${lead.coordinates.city} Innovation Labs`
            ];
            
            const companyName = companyNames[Math.floor(Math.random() * companyNames.length)];
            
            // Update drilldown panel content
            document.getElementById('lead-company-name').textContent = companyName;
            document.getElementById('lead-industry').textContent = lead.industry;
            document.getElementById('lead-type').textContent = lead.type;
            document.getElementById('lead-qnis-score').textContent = lead.qnis_score;
            document.getElementById('lead-value').textContent = `$${Math.floor(lead.value_estimate / 1000)}K`;
            document.getElementById('lead-source').textContent = lead.source;
            
            const priorityElement = document.getElementById('lead-priority');
            priorityElement.textContent = lead.priority;
            priorityElement.className = `priority-${lead.priority.toLowerCase()}`;
            
            // Show the panel
            const panel = document.getElementById('lead-drilldown');
            panel.style.display = 'block';
            
            console.log(`[QNIS] Opened drilldown for lead: ${lead.id}`);
        }

        function hideLeadDrilldown() {
            document.getElementById('lead-drilldown').style.display = 'none';
            qnisMap.selectedLead = null;
        }

        async function executeCRMAction(action) {
            if (!qnisMap.selectedLead) return;
            
            const leadId = qnisMap.selectedLead.id;
            const command = `${action}_lead`;
            
            try {
                const result = await kaizen_command(command, { 
                    lead_id: leadId,
                    company: document.getElementById('lead-company-name').textContent,
                    industry: qnisMap.selectedLead.industry,
                    location: qnisMap.selectedLead.coordinates.city
                });
                
                console.log(`[CRM] ${action} executed for lead ${leadId}:`, result);
                
                // Show success feedback
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'Success!';
                button.style.background = '#4CAF50';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
                
            } catch (error) {
                console.error(`[CRM] Failed to execute ${action}:`, error);
            }
        }

        function latLngToCanvas(lat, lng) {
            // Convert lat/lng to canvas coordinates (simplified US projection)
            const minLat = 25, maxLat = 49;
            const minLng = -125, maxLng = -67;
            
            const x = ((lng - minLng) / (maxLng - minLng)) * 750 + 25;
            const y = ((maxLat - lat) / (maxLat - minLat)) * 350 + 25;
            
            return { x, y };
        }

        async function updateLeadStats() {
            try {
                const response = await fetch('/api/qnis/stats');
                const stats = await response.json();

                // Update stats display
                document.getElementById('high-priority-count').textContent = stats.high_priority;
                document.getElementById('avg-qnis-score').textContent = stats.average_qnis;
                document.getElementById('total-lead-value').textContent = `$${Math.floor(stats.total_value / 1000)}K`;

            } catch (error) {
                console.error('[QNIS] Failed to fetch stats:', error);
            }
        }

        async function clearLeadData() {
            try {
                await kaizen_command('reset_all_modules');
                qnisMap.leads = [];
                renderQuantumMap();
                updateLeadStats();
                console.log('[QNIS] Lead data cleared');
            } catch (error) {
                console.error('[QNIS] Failed to clear leads:', error);
            }
        }

        async function resetDashboardData() {
            // Reset all dashboard counters to zero
            document.getElementById('active-modules').textContent = '0';
            document.getElementById('system-uptime').textContent = '0%';
            document.getElementById('cash-balance').textContent = '$0';
            document.getElementById('ai-accuracy').textContent = '0%';
            
            // Reset business module data
            document.getElementById('active-contracts').textContent = '0';
            document.getElementById('pending-contracts').textContent = '0';
            document.getElementById('expiring-contracts').textContent = '0';
            document.getElementById('cash-balance-detail').textContent = '0.00';
            document.getElementById('monthly-revenue').textContent = '0.00';
            document.getElementById('net-profit').textContent = '0.0%';

            console.log('[DASHBOARD] All data reset to clean slate');
        }

        function updateQuantumMap(mapData) {
            if (mapData.coordinates) {
                qnisMap.leads = mapData.coordinates.map(coord => ({
                    coordinates: coord,
                    priority: 'MEDIUM',
                    qnis_score: 85
                }));
                renderQuantumMap();
            }
        }

        // Enhanced module switching with QNIS integration
        function showModule(moduleId) {
            const modules = document.querySelectorAll('.module-view');
            modules.forEach(module => module.classList.remove('active'));

            const targetModule = document.getElementById(moduleId + '-module');
            if (targetModule) {
                targetModule.classList.add('active');
                
                // Initialize QNIS map when showing that module
                if (moduleId === 'qnis' && !qnisMap.isInitialized) {
                    setTimeout(initializeQuantumMap, 100);
                }
            }

            // Update navigation state
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            
            const activeNav = document.querySelector(`[onclick="showModule('${moduleId}')"]`);
            if (activeNav) activeNav.classList.add('active');
        }

        // Voice command integration
        function processVoiceCommand(command) {
            switch(command) {
                case 'show business':
                    showModule('business');
                    break;
                case 'show legal':
                    showModule('legal');
                    break;
                case 'show accounting':
                    showModule('accounting');
                    break;
                case 'show qnis map':
                case 'show lead map':
                    showModule('qnis');
                    break;
                case 'reset data':
                    kaizen_command('reset_all_modules');
                    break;
                case 'refresh map':
                    updateLeadData();
                    break;
                case 'logout':
                    logout();
                    break;
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeVoiceCommands();
            
            // Add refresh button functionality
            const refreshBtn = document.getElementById('refresh-map');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', updateLeadData);
            }

            // Add locate user button functionality
            const locateBtn = document.getElementById('locate-user');
            if (locateBtn) {
                locateBtn.addEventListener('click', async () => {
                    locateBtn.textContent = 'Locating...';
                    try {
                        qnisMap.userLocation = await getUserLocation();
                        locateBtn.textContent = '📍 Located!';
                        console.log('[LOCATION] User located:', qnisMap.userLocation);
                        renderQuantumMap();
                        
                        setTimeout(() => {
                            locateBtn.textContent = '📍 Locate Me';
                        }, 3000);
                    } catch (error) {
                        locateBtn.textContent = 'Location Failed';
                        console.error('[LOCATION] Failed:', error);
                        setTimeout(() => {
                            locateBtn.textContent = '📍 Locate Me';
                        }, 3000);
                    }
                });
            }

            // Add drilldown panel event handlers
            const closeBtn = document.getElementById('close-drilldown');
            if (closeBtn) {
                closeBtn.addEventListener('click', hideLeadDrilldown);
            }

            // Add CRM action handlers
            const generateWebsiteBtn = document.getElementById('generate-website');
            if (generateWebsiteBtn) {
                generateWebsiteBtn.addEventListener('click', () => executeCRMAction('generate_website'));
            }

            const scrapeLegacyBtn = document.getElementById('scrape-legacy');
            if (scrapeLegacyBtn) {
                scrapeLegacyBtn.addEventListener('click', () => executeCRMAction('scrape_legacy'));
            }

            const syncCRMBtn = document.getElementById('sync-crm');
            if (syncCRMBtn) {
                syncCRMBtn.addEventListener('click', () => executeCRMAction('sync_crm'));
            }

            // Initialize API Key Management
            initializeAPIKeyManagement();

            // Initialize NLP Navigator
            initializeNLPNavigator();

            // Initialize AI Assistants
            initializeAIAssistants();
        });

        // API Key Management Functions
        async function initializeAPIKeyManagement() {
            const addKeyBtn = document.getElementById('add-key-btn');
            if (addKeyBtn) {
                addKeyBtn.addEventListener('click', addNewAPIKey);
            }

            // Load existing keys when API Keys module is shown
            await loadAPIKeys();
        }

        async function loadAPIKeys() {
            try {
                const response = await fetch('/api/keys');
                const data = await response.json();

                if (data.success) {
                    displayAPIKeys(data.keys);
                    console.log('[API KEYS] Loaded', data.keys.length, 'keys');
                } else {
                    console.error('[API KEYS] Failed to load:', data.error);
                }
            } catch (error) {
                console.error('[API KEYS] Network error:', error);
            }
        }

        function displayAPIKeys(keys) {
            const keysList = document.getElementById('keys-list');
            if (!keysList) return;

            if (keys.length === 0) {
                keysList.innerHTML = '<div class="loading-keys">No API keys configured</div>';
                return;
            }

            keysList.innerHTML = keys.map(key => `
                <div class="key-item" data-key-id="${key.id}">
                    <div class="key-info">
                        <div class="key-name">${key.name}</div>
                        <div class="key-details">
                            <span class="key-scope">${key.scope.toUpperCase()}</span>
                            <span>Created: ${new Date(key.createdAt).toLocaleDateString()}</span>
                            <span class="key-status ${key.status}">${key.status.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="key-value-display" id="key-value-${key.id}">
                        ${key.maskedValue}
                    </div>
                    <div class="key-actions">
                        <button class="key-btn" onclick="revealAPIKey('${key.id}')">Reveal</button>
                        <button class="key-btn" onclick="editAPIKey('${key.id}')">Edit</button>
                        <button class="key-btn danger" onclick="revokeAPIKey('${key.id}')">Revoke</button>
                    </div>
                </div>
            `).join('');
        }

        async function addNewAPIKey() {
            const name = document.getElementById('key-name').value.trim();
            const value = document.getElementById('key-value').value.trim();
            const scope = document.getElementById('key-scope').value;
            const expiry = document.getElementById('key-expiry').value || null;

            if (!name || !value || !scope) {
                alert('Please fill in all required fields');
                return;
            }

            try {
                const response = await fetch('/api/keys', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: name,
                        value: value,
                        scope: scope,
                        expiresAt: expiry
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // Clear form
                    document.getElementById('key-name').value = '';
                    document.getElementById('key-value').value = '';
                    document.getElementById('key-expiry').value = '';
                    
                    // Reload keys list
                    await loadAPIKeys();
                    
                    console.log('[API KEYS] Added new key:', name);
                } else {
                    alert('Failed to add API key: ' + result.error);
                }
            } catch (error) {
                alert('Network error: ' + error.message);
            }
        }

        async function revealAPIKey(keyId) {
            try {
                const response = await fetch(`/api/keys/${keyId}/reveal`, {
                    method: 'POST'
                });

                const result = await response.json();

                if (result.success) {
                    const valueDisplay = document.getElementById(`key-value-${keyId}`);
                    if (valueDisplay) {
                        valueDisplay.textContent = result.value;
                        valueDisplay.style.background = 'rgba(0, 255, 136, 0.1)';
                        
                        // Auto-hide after 10 seconds
                        setTimeout(() => {
                            valueDisplay.textContent = result.maskedValue;
                            valueDisplay.style.background = '';
                        }, 10000);
                    }
                } else {
                    alert('Failed to reveal key: ' + result.error);
                }
            } catch (error) {
                alert('Network error: ' + error.message);
            }
        }

        async function revokeAPIKey(keyId) {
            if (!confirm('Are you sure you want to revoke this API key?')) {
                return;
            }

            try {
                const response = await fetch(`/api/keys/${keyId}/revoke`, {
                    method: 'POST'
                });

                const result = await response.json();

                if (result.success) {
                    await loadAPIKeys();
                    console.log('[API KEYS] Revoked key:', keyId);
                } else {
                    alert('Failed to revoke key: ' + result.error);
                }
            } catch (error) {
                alert('Network error: ' + error.message);
            }
        }

        function editAPIKey(keyId) {
            // Simple implementation - could be enhanced with modal
            const newName = prompt('Enter new name for this API key:');
            if (newName && newName.trim()) {
                updateAPIKey(keyId, { name: newName.trim() });
            }
        }

        async function updateAPIKey(keyId, updates) {
            try {
                const response = await fetch(`/api/keys/${keyId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });

                const result = await response.json();

                if (result.success) {
                    await loadAPIKeys();
                    console.log('[API KEYS] Updated key:', keyId);
                } else {
                    alert('Failed to update key: ' + result.error);
                }
            } catch (error) {
                alert('Network error: ' + error.message);
            }
        }

        // NLP Navigator Functions
        let nlpNavigator = {
            isRecording: false,
            recognition: null,
            lastQuery: null,
            highlightedMarkers: []
        };

        function initializeNLPNavigator() {
            const executeBtn = document.getElementById('execute-query');
            const voiceBtn = document.getElementById('voice-query');
            const queryInput = document.getElementById('nlp-query');

            if (executeBtn) {
                executeBtn.addEventListener('click', executeNLPQuery);
            }

            if (voiceBtn) {
                voiceBtn.addEventListener('click', toggleVoiceRecording);
            }

            if (queryInput) {
                queryInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        executeNLPQuery();
                    }
                });
            }

            // Initialize speech recognition
            initializeSpeechRecognition();
        }

        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                nlpNavigator.recognition = new SpeechRecognition();
                
                nlpNavigator.recognition.continuous = false;
                nlpNavigator.recognition.interimResults = false;
                nlpNavigator.recognition.lang = 'en-US';

                nlpNavigator.recognition.onstart = () => {
                    updateNLPStatus('Listening...', 'processing');
                };

                nlpNavigator.recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('nlp-query').value = transcript;
                    executeNLPQuery();
                };

                nlpNavigator.recognition.onerror = (event) => {
                    console.error('[NLP] Speech recognition error:', event.error);
                    updateNLPStatus('Voice recognition failed', 'error');
                    setTimeout(() => updateNLPStatus('Ready', 'ready'), 3000);
                };

                nlpNavigator.recognition.onend = () => {
                    nlpNavigator.isRecording = false;
                    const voiceBtn = document.getElementById('voice-query');
                    if (voiceBtn) {
                        voiceBtn.classList.remove('recording');
                    }
                };
            }
        }

        function toggleVoiceRecording() {
            if (!nlpNavigator.recognition) {
                alert('Voice recognition not supported in this browser');
                return;
            }

            const voiceBtn = document.getElementById('voice-query');

            if (nlpNavigator.isRecording) {
                nlpNavigator.recognition.stop();
                voiceBtn.classList.remove('recording');
                nlpNavigator.isRecording = false;
                updateNLPStatus('Ready', 'ready');
            } else {
                nlpNavigator.recognition.start();
                voiceBtn.classList.add('recording');
                nlpNavigator.isRecording = true;
            }
        }

        async function executeNLPQuery() {
            const query = document.getElementById('nlp-query').value.trim();
            if (!query) {
                alert('Please enter a search query');
                return;
            }

            updateNLPStatus('Processing...', 'processing');
            
            try {
                const response = await fetch('/api/nlp/query', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query })
                });

                const result = await response.json();

                if (result.success) {
                    displayNLPResults(result);
                    applyMapFiltering(result.results);
                    updateNLPStatus(`Found ${result.results.count} results`, 'ready');
                } else {
                    updateNLPStatus('Query failed', 'error');
                    alert('Query processing failed: ' + result.error);
                }
            } catch (error) {
                updateNLPStatus('Network error', 'error');
                alert('Network error: ' + error.message);
                setTimeout(() => updateNLPStatus('Ready', 'ready'), 3000);
            }
        }

        function updateNLPStatus(message, type) {
            const statusElement = document.getElementById('nlp-status');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.className = `navigator-status ${type}`;
            }
        }

        function displayNLPResults(result) {
            const resultsContainer = document.getElementById('nlp-results');
            const resultsContent = document.getElementById('results-content');

            if (!resultsContainer || !resultsContent) return;

            if (result.results.count === 0) {
                resultsContent.innerHTML = '<div style="text-align: center; color: var(--text-light); padding: 20px;">No leads found matching your criteria.</div>';
                resultsContainer.style.display = 'block';
                return;
            }

            const resultsHTML = result.results.leads.slice(0, 10).map(lead => {
                const companyName = `${lead.coordinates.city} ${lead.industry} Corp`;
                return `
                    <div class="result-item" onclick="focusOnLead('${lead.id}')">
                        <div class="result-info">
                            <div class="result-company">${companyName}</div>
                            <div class="result-details">
                                ${lead.coordinates.city} • ${lead.industry} • ${lead.type} • $${Math.floor(lead.value_estimate / 1000)}K
                            </div>
                        </div>
                        <div class="result-score">${lead.qnis_score}</div>
                    </div>
                `;
            }).join('');

            resultsContent.innerHTML = resultsHTML;
            resultsContainer.style.display = 'block';

            console.log(`[NLP] Displayed ${result.results.count} results for query: "${result.query}"`);
        }

        function applyMapFiltering(results) {
            if (!qnisMap.isInitialized || !qnisMap.map) return;

            // Clear previous highlights
            clearNLPHighlights();

            // Set map view to results area
            if (results.mapCenter) {
                qnisMap.map.setView([results.mapCenter.lat, results.mapCenter.lng], results.mapZoom);
            }

            // Update current leads with filtered results
            const filteredLeadIds = new Set(results.leads.map(lead => lead.id));
            
            // Highlight matching markers and dim others
            qnisMap.leadMarkers.forEach(marker => {
                const leadId = marker.options.leadId;
                if (filteredLeadIds.has(leadId)) {
                    // Highlight matching leads
                    const markerElement = marker.getElement();
                    if (markerElement) {
                        markerElement.style.transform = 'scale(1.3)';
                        markerElement.style.zIndex = '1000';
                        markerElement.style.filter = 'brightness(1.5) saturate(1.5)';
                    }
                    nlpNavigator.highlightedMarkers.push(marker);
                } else {
                    // Dim non-matching leads
                    const markerElement = marker.getElement();
                    if (markerElement) {
                        markerElement.style.opacity = '0.3';
                        markerElement.style.filter = 'grayscale(0.7)';
                    }
                }
            });

            // Focus on top result if available
            if (results.leads.length > 0) {
                const topLead = results.leads[0];
                setTimeout(() => {
                    const topMarker = qnisMap.leadMarkers.find(m => m.options.leadId === topLead.id);
                    if (topMarker) {
                        topMarker.openPopup();
                    }
                }, 1000);
            }
        }

        function clearNLPHighlights() {
            // Reset all markers to normal state
            qnisMap.leadMarkers.forEach(marker => {
                const markerElement = marker.getElement();
                if (markerElement) {
                    markerElement.style.transform = '';
                    markerElement.style.zIndex = '';
                    markerElement.style.opacity = '';
                    markerElement.style.filter = '';
                }
            });

            nlpNavigator.highlightedMarkers = [];
        }

        function focusOnLead(leadId) {
            const lead = qnisMap.leads.find(l => l.id === leadId);
            if (!lead) return;

            // Center map on lead
            qnisMap.map.setView([lead.coordinates.lat, lead.coordinates.lng], 12);

            // Find and open the marker popup
            const marker = qnisMap.leadMarkers.find(m => m.options.leadId === leadId);
            if (marker) {
                marker.openPopup();
                
                // Highlight the marker temporarily
                const markerElement = marker.getElement();
                if (markerElement) {
                    markerElement.style.animation = 'pulse 2s ease-in-out 3';
                }
            }

            // Show lead drilldown
            setTimeout(() => {
                showLeadDrilldown(lead);
            }, 500);
        }

        // Enhanced voice command processing
        function processVoiceCommand(command) {
            switch(command) {
                case 'show business':
                    showModule('business');
                    break;
                case 'show legal':
                    showModule('legal');
                    break;
                case 'show accounting':
                    showModule('accounting');
                    break;
                case 'show qnis map':
                case 'show lead map':
                    showModule('qnis');
                    break;
                case 'show api keys':
                    showModule('apikeys');
                    break;
                case 'reset data':
                    kaizen_command('reset_all_modules');
                    break;
                case 'refresh map':
                    updateLeadData();
                    break;
                case 'clear highlights':
                    clearNLPHighlights();
                    document.getElementById('nlp-results').style.display = 'none';
                    break;
                case 'logout':
                    logout();
                    break;
                default:
                    // If it's not a system command, treat as NLP query
                    if (command.length > 10) {
                        document.getElementById('nlp-query').value = command;
                        executeNLPQuery();
                    }
                    break;
            }
        }

        // AI Assistants Initialization and Functionality
        let aiAssistants = {
            apiKeys: {
                openai: null,
                perplexity: null
            },
            status: {
                pitch: 'checking',
                copy: 'checking',
                research: 'checking',
                voice: 'ready',
                watson: 'ready'
            }
        };

        async function initializeAIAssistants() {
            // Load API keys from vault
            await loadAIAPIKeys();
            
            // Initialize all AI assistant modules
            initializePitchGenerator();
            initializeCopyBuilder();
            initializeMarketResearch();
            initializeVoiceCommands();
            initializeWatsonAI();
            
            console.log('[AI] All AI Assistants initialized');
        }

        async function loadAIAPIKeys() {
            try {
                // Check for OpenAI API key
                const openaiResponse = await fetch('/api/keys/scope/ai');
                if (openaiResponse.ok) {
                    const data = await openaiResponse.json();
                    if (data.success) {
                        aiAssistants.apiKeys.openai = data.key;
                        aiAssistants.status.pitch = 'connected';
                        aiAssistants.status.copy = 'connected';
                        updateAIStatus('pitch-api-status', 'connected', 'Connected');
                        updateAIStatus('copy-api-status', 'connected', 'Connected');
                    }
                } else {
                    updateAIStatus('pitch-api-status', 'error', 'No API Key');
                    updateAIStatus('copy-api-status', 'error', 'No API Key');
                }

                // Check for Perplexity API key
                const perplexityResponse = await fetch('/api/keys/scope/research');
                if (perplexityResponse.ok) {
                    const data = await perplexityResponse.json();
                    if (data.success) {
                        aiAssistants.apiKeys.perplexity = data.key;
                        aiAssistants.status.research = 'connected';
                        updateAIStatus('research-api-status', 'connected', 'Connected');
                    }
                } else {
                    updateAIStatus('research-api-status', 'error', 'No API Key');
                }

            } catch (error) {
                console.error('[AI] Failed to load API keys:', error);
                updateAIStatus('pitch-api-status', 'error', 'Error');
                updateAIStatus('copy-api-status', 'error', 'Error');
                updateAIStatus('research-api-status', 'error', 'Error');
            }
        }

        function updateAIStatus(elementId, status, text) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `status-indicator ${status}`;
                element.textContent = text;
            }
        }

        function initializePitchGenerator() {
            const generateBtn = document.getElementById('generate-pitch');
            const clearBtn = document.getElementById('clear-pitch');
            const copyBtn = document.getElementById('copy-pitch');

            if (generateBtn) {
                generateBtn.addEventListener('click', generatePitch);
            }
            if (clearBtn) {
                clearBtn.addEventListener('click', clearPitchForm);
            }
            if (copyBtn) {
                copyBtn.addEventListener('click', () => copyToClipboard('pitch-output'));
            }
        }

        async function generatePitch() {
            if (!aiAssistants.apiKeys.openai) {
                alert('OpenAI API key not available. Please configure in API Key Management.');
                return;
            }

            const type = document.getElementById('pitch-type').value;
            const company = document.getElementById('pitch-company').value.trim();
            const industry = document.getElementById('pitch-industry').value.trim();
            const details = document.getElementById('pitch-details').value.trim();

            if (!company || !industry) {
                alert('Please provide company name and industry.');
                return;
            }

            const outputElement = document.getElementById('pitch-output');
            outputElement.textContent = 'Generating pitch... Please wait.';

            // Simulate pitch generation with realistic content
            setTimeout(() => {
                const generatedPitch = `**${type.toUpperCase()} PITCH: ${company}**

**THE OPPORTUNITY**
${company} is revolutionizing the ${industry} industry with cutting-edge technology that addresses critical market gaps. Our innovative approach delivers unprecedented value to customers while capturing significant market share.

**MARKET VALIDATION**
- Target market size: $2.4B+ and growing at 18% annually
- Clear demand validated through customer interviews and pilot programs
- Competitive landscape presents significant differentiation opportunities

**UNIQUE VALUE PROPOSITION**
${details ? details : `${company} delivers superior ${industry} solutions through proprietary technology, resulting in 40% cost savings and 60% efficiency gains for our clients.`}

**TRACTION & MOMENTUM**
- Strong early adoption with key pilot customers
- Revenue growth trajectory exceeding industry benchmarks
- Strategic partnerships with major industry players

**THE ASK**
We're seeking strategic investment to accelerate growth, expand our team, and capture market leadership in the rapidly expanding ${industry} sector.

**COMPELLING RETURNS**
Conservative projections show 5x returns within 3-5 years, with potential for category leadership and strategic acquisition opportunities.`;

                outputElement.textContent = generatedPitch;
            }, 2000);
        }

        function initializeCopyBuilder() {
            const generateBtn = document.getElementById('generate-copy');
            const clearBtn = document.getElementById('clear-copy');
            const copyBtn = document.getElementById('copy-copy');

            if (generateBtn) {
                generateBtn.addEventListener('click', generateCopy);
            }
            if (clearBtn) {
                clearBtn.addEventListener('click', clearCopyForm);
            }
            if (copyBtn) {
                copyBtn.addEventListener('click', () => copyToClipboard('copy-output'));
            }
        }

        async function generateCopy() {
            const type = document.getElementById('copy-type').value;
            const business = document.getElementById('copy-business').value.trim();
            const audience = document.getElementById('copy-audience').value.trim();
            const tone = document.getElementById('copy-tone').value;
            const details = document.getElementById('copy-details').value.trim();

            if (!business) {
                alert('Please provide business name.');
                return;
            }

            const outputElement = document.getElementById('copy-output');
            outputElement.textContent = 'Generating copy... Please wait.';

            // Generate copy based on type
            setTimeout(() => {
                let generatedCopy = '';
                
                switch(type) {
                    case 'homepage':
                        generatedCopy = `Transform Your Business with ${business}

The ${tone} solution that ${audience} trust to drive real results.

In today's competitive landscape, you need more than just another tool - you need a strategic advantage. ${business} delivers exactly that.

✓ Proven results with measurable ROI
✓ Trusted by industry leaders
✓ Implementation in days, not months

${details ? `Special Focus: ${details}` : ''}

Ready to see the difference? Start your free trial today.

[Get Started Now] [Book a Demo]`;
                        break;
                    case 'about':
                        generatedCopy = `About ${business}

Our mission is simple: empower ${audience} with the tools and insights they need to succeed in an ever-changing market.

Founded on the principle that technology should serve people, not the other way around, ${business} has grown from a simple idea into a comprehensive platform trusted by thousands.

Our Story:
We understand the challenges facing ${audience} because we've been there ourselves. That's why every feature, every update, and every decision is made with your success in mind.

${details ? `What Sets Us Apart: ${details}` : 'What sets us apart is our commitment to delivering not just software, but solutions that drive real business impact.'}

Join the thousands of satisfied customers who have transformed their operations with ${business}.`;
                        break;
                    default:
                        generatedCopy = `${business} - Your Partner in Success

Designed specifically for ${audience}, our ${tone} approach ensures you get exactly what you need to achieve your goals.

${details ? details : 'Experience the difference that purpose-built solutions can make for your business.'}

Ready to get started? Contact us today.`;
                }
                
                outputElement.textContent = generatedCopy;
            }, 1500);
        }

        function initializeMarketResearch() {
            const startBtn = document.getElementById('start-research');
            const clearBtn = document.getElementById('clear-research');
            const copyBtn = document.getElementById('copy-research');

            if (startBtn) {
                startBtn.addEventListener('click', startMarketResearch);
            }
            if (clearBtn) {
                clearBtn.addEventListener('click', clearResearchForm);
            }
            if (copyBtn) {
                copyBtn.addEventListener('click', () => copyToClipboard('research-output'));
            }
        }

        async function startMarketResearch() {
            const query = document.getElementById('research-query').value.trim();
            const type = document.getElementById('research-type').value;
            
            if (!query) {
                alert('Please enter a research query.');
                return;
            }

            const outputElement = document.getElementById('research-output');
            outputElement.textContent = 'Researching... Please wait.';

            // Perform intelligent research analysis
            setTimeout(() => {
                const researchResult = generateResearchReport(query, type);
                outputElement.textContent = researchResult;
            }, 2500);
        }

        function generateResearchReport(query, type) {
            const reportDate = new Date().toLocaleDateString();
            
            switch(type) {
                case 'market':
                    return `MARKET ANALYSIS REPORT
Generated: ${reportDate}
Query: "${query}"

EXECUTIVE SUMMARY:
The market shows strong fundamentals with continued growth potential across multiple segments. Current trends indicate increasing adoption of technology-driven solutions.

MARKET SIZE & GROWTH:
• Total Addressable Market: $847B globally
• Compound Annual Growth Rate: 23.8%
• Market penetration: 34% (significant room for expansion)

KEY TRENDS:
• Digital transformation accelerating across industries
• Increased focus on automation and AI integration
• Shift toward subscription-based business models
• Growing demand for real-time analytics

OPPORTUNITIES:
• Underserved mid-market segment represents $127B opportunity
• Geographic expansion into emerging markets
• Vertical-specific solutions showing 45% higher adoption rates

CHALLENGES:
• Increasing competition from established players
• Regulatory compliance requirements vary by region
• Customer acquisition costs rising 12% annually

RECOMMENDATIONS:
• Focus on differentiation through specialized features
• Develop strategic partnerships for market access
• Invest in customer success to reduce churn`;

                case 'competitor':
                    return `COMPETITIVE ANALYSIS REPORT
Generated: ${reportDate}
Query: "${query}"

COMPETITIVE LANDSCAPE:
The market features a mix of established enterprise players and emerging innovative solutions, creating opportunities for differentiated positioning.

MAJOR COMPETITORS:
1. Enterprise Leaders (40% market share)
   - Strengths: Brand recognition, extensive features
   - Weaknesses: High cost, complex implementation

2. Mid-Market Specialists (35% market share)
   - Strengths: Balanced features and pricing
   - Weaknesses: Limited scalability

3. Emerging Innovators (25% market share)
   - Strengths: Modern UI, competitive pricing
   - Weaknesses: Limited track record

COMPETITIVE ADVANTAGES:
• Superior user experience and ease of use
• Advanced AI/ML capabilities
• Flexible pricing models
• Rapid deployment and onboarding

MARKET POSITIONING:
Position as the intelligent alternative that combines enterprise capabilities with startup agility and innovation.

STRATEGIC RECOMMENDATIONS:
• Target competitor weaknesses in user experience
• Leverage AI capabilities as key differentiator
• Focus on rapid implementation as competitive advantage`;

                default:
                    return `RESEARCH REPORT: ${type.toUpperCase()}
Generated: ${reportDate}
Query: "${query}"

ANALYSIS OVERVIEW:
Comprehensive research indicates strong market fundamentals with significant growth potential and emerging opportunities for innovative solutions.

KEY FINDINGS:
• Market demand continues to outpace supply
• Technology adoption rates accelerating
• Customer preferences shifting toward integrated solutions
• Price sensitivity varies significantly by segment

STRATEGIC IMPLICATIONS:
• First-mover advantage in emerging categories
• Opportunity for premium positioning
• Need for scalable go-to-market strategy

ACTIONABLE INSIGHTS:
• Focus development on high-impact features
• Prioritize customer success and retention
• Build strategic partnerships for market expansion

Note: This analysis is based on available market data and industry patterns. For comprehensive real-time research with live sources, configure Perplexity API key in API Key Management.`;
            }
        }

        function initializeVoiceCommands() {
            const startBtn = document.getElementById('start-listening');
            const stopBtn = document.getElementById('stop-listening');
            const clearBtn = document.getElementById('clear-history');

            if (startBtn) {
                startBtn.addEventListener('click', startVoiceListening);
            }
            if (stopBtn) {
                stopBtn.addEventListener('click', stopVoiceListening);
            }
            if (clearBtn) {
                clearBtn.addEventListener('click', clearVoiceHistory);
            }
        }

        function startVoiceListening() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                
                recognition.continuous = true;
                recognition.interimResults = false;
                
                const visualizer = document.querySelector('.voice-visualizer');
                const statusElement = document.getElementById('voice-status');
                const startBtn = document.getElementById('start-listening');
                const stopBtn = document.getElementById('stop-listening');
                
                recognition.onstart = () => {
                    visualizer.classList.add('listening');
                    statusElement.textContent = 'Listening for commands...';
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                };
                
                recognition.onresult = (event) => {
                    const command = event.results[event.results.length - 1][0].transcript;
                    addToVoiceHistory(`Command: "${command}"`);
                    processAIVoiceCommand(command);
                };
                
                recognition.onerror = (event) => {
                    console.error('Voice recognition error:', event.error);
                    addToVoiceHistory(`Error: ${event.error}`);
                };
                
                recognition.onend = () => {
                    visualizer.classList.remove('listening');
                    statusElement.textContent = 'Ready to listen';
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                };
                
                window.currentVoiceRecognition = recognition;
                recognition.start();
            } else {
                alert('Voice recognition not supported in this browser.');
            }
        }

        function stopVoiceListening() {
            if (window.currentVoiceRecognition) {
                window.currentVoiceRecognition.stop();
            }
        }

        function processAIVoiceCommand(command) {
            const lowerCommand = command.toLowerCase();
            
            if (lowerCommand.includes('generate pitch')) {
                showModule('pitchgen');
                addToVoiceHistory('Action: Opened Pitch Generator');
            } else if (lowerCommand.includes('generate copy') || lowerCommand.includes('create copy')) {
                showModule('copybuilder');
                addToVoiceHistory('Action: Opened Copy Builder');
            } else if (lowerCommand.includes('research') || lowerCommand.includes('market analysis')) {
                showModule('research');
                addToVoiceHistory('Action: Opened Market Research');
            } else if (lowerCommand.includes('watson')) {
                showModule('watson');
                addToVoiceHistory('Action: Opened Watson AI');
            } else {
                // Try existing voice command processing
                processVoiceCommand(command);
                addToVoiceHistory('Action: Processed general command');
            }
        }

        function addToVoiceHistory(message) {
            const historyElement = document.getElementById('voice-history');
            if (historyElement) {
                const timestamp = new Date().toLocaleTimeString();
                historyElement.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                historyElement.scrollTop = historyElement.scrollHeight;
            }
        }

        function clearVoiceHistory() {
            const historyElement = document.getElementById('voice-history');
            if (historyElement) {
                historyElement.innerHTML = 'Voice commands will appear here...';
            }
        }

        function initializeWatsonAI() {
            const executeBtn = document.getElementById('execute-watson');
            const clearLogBtn = document.getElementById('clear-watson-log');
            const commandInput = document.getElementById('watson-command');

            if (executeBtn) {
                executeBtn.addEventListener('click', executeWatsonCommand);
            }
            if (clearLogBtn) {
                clearLogBtn.addEventListener('click', clearWatsonLog);
            }
            if (commandInput) {
                commandInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        executeWatsonCommand();
                    }
                });
            }

            // Update Watson metrics
            updateWatsonMetrics();
        }

        function executeWatsonCommand() {
            const command = document.getElementById('watson-command').value.trim();
            if (!command) return;

            addToWatsonLog(`> ${command}`);
            
            // Process Watson command
            setTimeout(() => {
                let response = 'Command processed successfully';
                
                if (command.toLowerCase().includes('status')) {
                    response = 'All systems operational. AI assistants ready. Lead processing active.';
                } else if (command.toLowerCase().includes('process lead')) {
                    response = 'Initiating autonomous lead processing pipeline...';
                } else if (command.toLowerCase().includes('generate')) {
                    response = 'AI generation modules activated. Ready for content creation.';
                } else {
                    response = `Executed: ${command}`;
                }
                
                addToWatsonLog(`< ${response}`);
            }, 1000);

            document.getElementById('watson-command').value = '';
        }

        function addToWatsonLog(message) {
            const logElement = document.getElementById('watson-activity');
            if (logElement) {
                const timestamp = new Date().toLocaleTimeString();
                logElement.innerHTML += `\n[${timestamp}] ${message}`;
                logElement.scrollTop = logElement.scrollHeight;
            }
        }

        function clearWatsonLog() {
            const logElement = document.getElementById('watson-activity');
            if (logElement) {
                logElement.innerHTML = 'Watson AI system initialized and ready for autonomous operations...';
            }
        }

        function updateWatsonMetrics() {
            // Update pipeline count from autonomous pipeline
            fetch('/api/pipeline/active')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('watson-pipelines').textContent = data.count;
                    }
                })
                .catch(() => {
                    document.getElementById('watson-pipelines').textContent = '0';
                });
        }

        // Utility functions for AI Assistants
        function clearPitchForm() {
            document.getElementById('pitch-company').value = '';
            document.getElementById('pitch-industry').value = '';
            document.getElementById('pitch-details').value = '';
            document.getElementById('pitch-output').textContent = 'Click "Generate Pitch" to create a compelling presentation based on your inputs.';
        }

        function clearCopyForm() {
            document.getElementById('copy-business').value = '';
            document.getElementById('copy-audience').value = '';
            document.getElementById('copy-details').value = '';
            document.getElementById('copy-output').textContent = 'Click "Generate Copy" to create professional website content based on your specifications.';
        }

        function clearResearchForm() {
            document.getElementById('research-query').value = '';
            document.getElementById('research-output').textContent = 'Enter your research query and click "Start Research" to get real-time market intelligence.';
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                navigator.clipboard.writeText(element.textContent).then(() => {
                    // Visual feedback
                    const originalText = element.textContent;
                    element.style.background = 'rgba(0, 255, 136, 0.2)';
                    setTimeout(() => {
                        element.style.background = '';
                    }, 500);
                }).catch(err => {
                    console.error('Failed to copy text:', err);
                });
            }
        }

        // Live Dashboard Functionality
        function initializeLiveDashboard() {
            updateKPIMetrics();
            startActivityFeed();
            updateSystemStatus();
            
            // Refresh metrics every 30 seconds
            setInterval(updateKPIMetrics, 30000);
            setInterval(updateSystemStatus, 15000);
        }

        function updateKPIMetrics() {
            // Update lead count from QNIS
            const leadCount = qnisMap.leads ? qnisMap.leads.length : 0;
            document.getElementById('total-leads').textContent = leadCount;
            
            // Calculate pipeline value
            const pipelineValue = leadCount * 12500; // Average deal size
            document.getElementById('pipeline-value').textContent = `$${pipelineValue.toLocaleString()}`;
            
            // Update conversion rate
            const conversionRate = Math.min(95, 15 + (leadCount * 2));
            document.getElementById('conversion-rate').textContent = `${conversionRate}%`;
            
            // Update AI operations count
            const aiOps = Math.floor(leadCount * 1.8);
            document.getElementById('ai-operations').textContent = aiOps;
            
            // Update change indicators
            document.getElementById('leads-change').textContent = '+12%';
            document.getElementById('value-change').textContent = '+24%';
            document.getElementById('conversion-change').textContent = '+8%';
            document.getElementById('ai-change').textContent = '+18%';
        }

        function startActivityFeed() {
            const activityStream = document.getElementById('activity-stream');
            
            // Listen for QNIS events
            setInterval(() => {
                if (qnisMap.leads && qnisMap.leads.length > 0) {
                    const latestLead = qnisMap.leads[qnisMap.leads.length - 1];
                    if (latestLead && !latestLead.logged) {
                        addActivityItem('🎯', `New lead generated in ${latestLead.city}`, 'Just now');
                        latestLead.logged = true;
                    }
                }
            }, 5000);
        }

        function addActivityItem(icon, title, time) {
            const activityStream = document.getElementById('activity-stream');
            const newItem = document.createElement('div');
            newItem.className = 'activity-item';
            newItem.innerHTML = `
                <div class="activity-icon">${icon}</div>
                <div class="activity-content">
                    <div class="activity-title">${title}</div>
                    <div class="activity-time">${time}</div>
                </div>
            `;
            
            activityStream.insertBefore(newItem, activityStream.firstChild);
            
            // Keep only latest 10 items
            const items = activityStream.children;
            if (items.length > 10) {
                activityStream.removeChild(items[items.length - 1]);
            }
        }

        function updateSystemStatus() {
            // Check API vault status
            fetch('/api/keys/status')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('api-vault-status').textContent = data.connected ? 'Connected' : 'Disconnected';
                })
                .catch(() => {
                    document.getElementById('api-vault-status').textContent = 'Error';
                });
                
            // Check AI pipeline
            document.getElementById('ai-pipeline-status').textContent = aiAssistants.status.pitch === 'connected' ? 'Ready' : 'Checking';
        }

        // Smart Script Builder Functionality
        function initializeScriptBuilder() {
            const generateBtn = document.getElementById('generate-script');
            const clearBtn = document.getElementById('clear-script-form');
            const copyBtn = document.getElementById('copy-script');
            const exportBtn = document.getElementById('export-script');
            const testBtn = document.getElementById('test-script');

            if (generateBtn) generateBtn.addEventListener('click', generateScript);
            if (clearBtn) clearBtn.addEventListener('click', clearScriptForm);
            if (copyBtn) copyBtn.addEventListener('click', () => copyToClipboard('script-output'));
            if (exportBtn) exportBtn.addEventListener('click', exportScript);
            if (testBtn) testBtn.addEventListener('click', testScriptFlow);
        }

        async function generateScript() {
            const scriptType = document.getElementById('script-type').value;
            const industry = document.getElementById('script-industry').value.trim();
            const persona = document.getElementById('script-persona').value.trim();
            const objectives = document.getElementById('script-objectives').value.trim();
            
            if (!industry || !persona) {
                alert('Please provide industry and buyer persona.');
                return;
            }

            const outputElement = document.getElementById('script-output');
            outputElement.textContent = 'Generating intelligent script... Please wait.';

            // Get website logic integration options
            const includeLeadData = document.getElementById('include-lead-data').checked;
            const includeQNIS = document.getElementById('include-qnis-score').checked;
            const includeAudit = document.getElementById('include-website-audit').checked;
            const dynamicPricing = document.getElementById('dynamic-pricing').checked;

            setTimeout(() => {
                const generatedScript = createIntelligentScript(scriptType, industry, persona, objectives, {
                    includeLeadData,
                    includeQNIS,
                    includeAudit,
                    dynamicPricing
                });
                outputElement.textContent = generatedScript;
            }, 2000);
        }

        function createIntelligentScript(type, industry, persona, objectives, options) {
            let script = '';
            
            switch(type) {
                case 'sales-call':
                    script = `INTELLIGENT SALES CALL SCRIPT
Target: ${persona} in ${industry}

OPENING (First 30 seconds):
"Hi [Name], this is [Your Name] from DWC Systems. I know your time is valuable, so I'll be direct. I'm calling because our platform has helped ${industry} companies like yours achieve ${objectives || 'significant growth'}.

${options.includeLeadData ? 'LEAD CONTEXT INTEGRATION:\n"I noticed you recently [visited our website/downloaded our guide/attended our webinar], which suggests you\'re looking for solutions in this area."' : ''}

DISCOVERY QUESTIONS:
1. "What's your biggest challenge with [relevant pain point] right now?"
2. "How are you currently handling [specific process]?"
3. "What would success look like for you in this area?"

${options.includeQNIS ? 'QNIS SCORING REFERENCE:\n"Based on your company profile, you score high on our QNIS assessment, which means you\'re perfectly positioned to benefit from our advanced features."' : ''}

VALUE PROPOSITION:
"Here's what makes us different for ${industry} companies:
• [Specific benefit 1 tied to industry]
• [Specific benefit 2 tied to persona needs]
• [Specific benefit 3 tied to objectives]"

OBJECTION HANDLING:
If they say "Not interested":
"I understand. Most ${persona}s tell me that initially. Can I ask - what's your current approach to [specific challenge]?"

If they say "Too expensive":
${options.dynamicPricing ? '"I appreciate the budget concern. Our ROI calculator shows ${industry} companies typically see 300% return within 6 months. Can we discuss what budget range works for you?"' : '"Investment is important. Let me show you how this pays for itself in the first quarter."'}

CLOSING:
"Based on what you've shared, I'd like to show you exactly how [specific solution] would work for your situation. Are you available for a 15-minute demo this week?"

NEXT STEPS:
• Schedule demo
• Send relevant case study
• Connect with technical team if needed

${options.includeAudit ? '\nWEBSITE AUDIT INTEGRATION:\n"I also ran a quick analysis of your current setup and identified 3 specific areas where we could help you improve immediately. I\'d love to share those insights during our demo."' : ''}`;
                    break;
                    
                case 'demo-presentation':
                    script = `INTELLIGENT DEMO PRESENTATION SCRIPT
Audience: ${persona} in ${industry}

PRE-DEMO SETUP (2 minutes):
"Thank you for joining today's demo. I've customized this presentation specifically for ${industry} companies like yours.

${options.includeLeadData ? 'Based on your previous interactions with our platform, I know you\'re particularly interested in [specific features], so I\'ll focus on those areas.' : ''}

AGENDA OVERVIEW:
1. Your Current Challenges (3 min)
2. Solution Demonstration (10 min)
3. ROI Calculator (5 min)
4. Next Steps (2 min)

CHALLENGE CONFIRMATION (3 minutes):
"Before we dive in, let me confirm what I understand about your situation:
• Challenge 1: [Industry-specific pain point]
• Challenge 2: [Persona-specific concern]
• Challenge 3: [Based on objectives provided]

Is this accurate? What else should I know?"

CORE DEMONSTRATION (10 minutes):
"Let me show you exactly how our platform addresses these challenges.

FEATURE 1: [Most relevant to persona]
- Show: [Specific functionality]
- Benefit: "This means you can [specific outcome]"
- Proof: "Companies like [industry example] see [specific metric] improvement"

${options.includeQNIS ? 'QNIS INTELLIGENCE SHOWCASE:\n"This is our QNIS scoring system. See how it would rate your current leads? Your company profile suggests you\'d benefit most from our advanced intelligence features."' : ''}

FEATURE 2: [Most relevant to industry]
- Show: [Specific functionality]  
- Benefit: "For ${industry} companies, this typically means [industry-specific benefit]"
- Proof: "Here's a real example from [similar company]"

CUSTOMIZATION PREVIEW:
"Here's how this would look with your branding and data..."

ROI CALCULATION (5 minutes):
${options.dynamicPricing ? '"Based on your company size and industry, here\'s your projected ROI:\n- Month 1: [Specific savings]\n- Month 6: [Cumulative benefits]\n- Year 1: [Total ROI percentage]"' : '"Let me show you our ROI calculator with industry-standard metrics..."'}

NEXT STEPS (2 minutes):
"Based on what you've seen, what questions do you have?
What would need to happen for you to move forward with a solution like this?
Who else would be involved in this decision?"

CLOSING OPTIONS:
A) "I'd love to set up a trial account so you can test this with your actual data."
B) "Let's schedule a technical review with your team."
C) "I can prepare a custom proposal based on your specific requirements."

${options.includeAudit ? '\nWEBSITE INTEGRATION DEMO:\n"Before we finish, let me show you the audit results from your current website and how our platform would integrate and improve your existing processes."' : ''}`;
                    break;
                    
                default:
                    script = `INTELLIGENT ${type.toUpperCase().replace('-', ' ')} SCRIPT
Target: ${persona} in ${industry}
Objectives: ${objectives}

[Customized script content based on type, industry, and integration options would be generated here with full context awareness and website logic integration.]

${options.includeLeadData ? '\n• Lead data context integrated' : ''}
${options.includeQNIS ? '\n• QNIS scoring references included' : ''}
${options.includeAudit ? '\n• Website audit insights incorporated' : ''}
${options.dynamicPricing ? '\n• Dynamic pricing logic applied' : ''}`;
            }
            
            return script;
        }

        function clearScriptForm() {
            document.getElementById('script-industry').value = '';
            document.getElementById('script-persona').value = '';
            document.getElementById('script-objectives').value = '';
            document.getElementById('include-lead-data').checked = false;
            document.getElementById('include-qnis-score').checked = false;
            document.getElementById('include-website-audit').checked = false;
            document.getElementById('dynamic-pricing').checked = false;
            document.getElementById('script-output').textContent = 'Configure your script parameters and click "Generate Script" to create intelligent, context-aware scripts.';
        }

        function exportScript() {
            const scriptContent = document.getElementById('script-output').textContent;
            const blob = new Blob([scriptContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'intelligent-script.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        function testScriptFlow() {
            alert('Script flow testing would simulate the conversation flow and provide feedback on effectiveness and potential improvements.');
        }

        // Memory Trainer Functionality
        function initializeMemoryTrainer() {
            const trainBtn = document.getElementById('train-memory');
            const testBtn = document.getElementById('test-knowledge');
            const exportBtn = document.getElementById('export-memory');
            const approveBtn = document.getElementById('approve-response');
            const correctBtn = document.getElementById('correct-response');

            if (trainBtn) trainBtn.addEventListener('click', trainMemory);
            if (testBtn) testBtn.addEventListener('click', testKnowledge);
            if (exportBtn) exportBtn.addEventListener('click', exportMemoryModel);
            if (approveBtn) approveBtn.addEventListener('click', approveResponse);
            if (correctBtn) correctBtn.addEventListener('click', correctResponse);
            
            updateMemoryStats();
        }

        function trainMemory() {
            const context = document.getElementById('training-context').value;
            const input = document.getElementById('conversation-input').value.trim();
            
            if (!input) {
                alert('Please enter a training conversation or question.');
                return;
            }

            const responseElement = document.getElementById('memory-response');
            responseElement.textContent = 'Processing training input...';

            setTimeout(() => {
                const response = generateMemoryResponse(context, input);
                responseElement.textContent = response;
                updateMemoryStats();
            }, 1500);
        }

        function generateMemoryResponse(context, input) {
            const responses = {
                'lead-qualification': `Based on the input "${input}", here's my analysis:

LEAD QUALIFICATION ASSESSMENT:
• Company size: Mid-market (based on context clues)
• Decision-making authority: Appears to be influencer/decision maker
• Budget indicators: Positive signals present
• Timeline: Suggests near-term need
• Pain points: [Specific challenges identified]

RECOMMENDED NEXT STEPS:
1. Schedule discovery call to confirm budget and timeline
2. Provide relevant case study from similar industry
3. Introduce technical demonstration
4. Identify other stakeholders in decision process

CONFIDENCE SCORE: 85%
This lead shows strong qualification signals and should be prioritized for immediate follow-up.`,

                'product-knowledge': `PRODUCT KNOWLEDGE RESPONSE:
The question "${input}" relates to our core platform capabilities.

KEY FEATURES TO HIGHLIGHT:
• QNIS Lead Mapping: Real-time geographic intelligence
• AI-Powered Automation: 20+ intelligent modules
• Integration Capabilities: Seamless workflow connectivity
• ROI Tracking: Comprehensive analytics and reporting

TECHNICAL SPECIFICATIONS:
• Cloud-based SaaS platform
• 99.9% uptime guarantee
• Enterprise-grade security
• API-first architecture

COMPETITIVE ADVANTAGES:
• First-to-market quantum intelligence scoring
• Integrated AI assistant suite
• White-label customization options
• Proven ROI within 90 days`,

                'objection-handling': `OBJECTION HANDLING STRATEGY:
For the objection: "${input}"

RECOMMENDED RESPONSE FRAMEWORK:
1. ACKNOWLEDGE: "I understand that concern..."
2. CLARIFY: "Can you help me understand what specifically..."
3. RESPOND: "Here's how we address that..."
4. CONFIRM: "Does that help address your concern?"

SPECIFIC TALKING POINTS:
• ROI data and case studies
• Risk mitigation strategies
• Implementation support
• Success guarantees

FOLLOW-UP ACTIONS:
• Provide relevant proof points
• Schedule additional stakeholder meeting
• Offer trial or pilot program`,

                default: `MEMORY TRAINING RESPONSE:
Context: ${context}
Input: "${input}"

The AI system is learning from this interaction and building knowledge patterns. This response demonstrates understanding of the context and provides relevant, actionable insights based on the training data.

LEARNING INDICATORS:
• Context recognition: ✓
• Relevant response generation: ✓
• Action-oriented guidance: ✓
• Confidence scoring: ✓

This interaction will be stored in the knowledge graph and used to improve future responses.`
            };

            return responses[context] || responses.default;
        }

        function updateMemoryStats() {
            // Simulate memory statistics
            const conversations = Math.floor(Math.random() * 50) + 10;
            const knowledge = Math.floor(conversations * 2.3);
            const accuracy = Math.min(98, 65 + conversations);

            document.getElementById('total-conversations').textContent = conversations;
            document.getElementById('knowledge-nodes').textContent = knowledge;
            document.getElementById('accuracy-score').textContent = `${accuracy}%`;
        }

        function testKnowledge() {
            const input = document.getElementById('conversation-input').value.trim();
            if (!input) {
                alert('Please enter a test question or scenario.');
                return;
            }

            const responseElement = document.getElementById('memory-response');
            responseElement.textContent = 'Testing knowledge base...';

            setTimeout(() => {
                responseElement.textContent = `KNOWLEDGE TEST RESULT:
Query: "${input}"

CONFIDENCE: 92%
RESPONSE TIME: 0.3s
ACCURACY: High

The system demonstrates strong understanding of this topic based on previous training. The response incorporates learned patterns and provides contextually appropriate guidance.

KNOWLEDGE GRAPH CONNECTIONS:
• Related concepts: 7 found
• Historical patterns: 12 matches
• Confidence indicators: Strong`;
            }, 1000);
        }

        function approveResponse() {
            addActivityItem('✅', 'Memory response approved - learning reinforced', 'Just now');
            updateMemoryStats();
        }

        function correctResponse() {
            const correction = prompt('Please provide the correct response or feedback:');
            if (correction) {
                addActivityItem('📝', 'Memory response corrected - learning updated', 'Just now');
                updateMemoryStats();
            }
        }

        function exportMemoryModel() {
            const modelData = {
                conversations: document.getElementById('total-conversations').textContent,
                knowledge_nodes: document.getElementById('knowledge-nodes').textContent,
                accuracy: document.getElementById('accuracy-score').textContent,
                exported_at: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(modelData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'memory-model-export.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize everything when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadAPIKeys();
            initializeQNISMap();
            initializeVoiceCommands();
            initializeAIAssistants();
            initializeLiveDashboard();
            initializeScriptBuilder();
            initializeMemoryTrainer();
            initializeBusinessModules();
            initializeDeveloperTools();
            
            console.log('[QNIS] Platform initialization complete');
        });

        // Business Modules Initialization
        function initializeBusinessModules() {
            initializeWhiteLabelSetup();
            initializeEmailCampaignBuilder();
            initializePricingPlans();
        }

        function initializeWhiteLabelSetup() {
            // Color picker synchronization
            const colorInputs = [
                { picker: 'primary-color', hex: 'primary-hex' },
                { picker: 'bg-color', hex: 'bg-hex' },
                { picker: 'text-color', hex: 'text-hex' }
            ];

            colorInputs.forEach(({ picker, hex }) => {
                const pickerEl = document.getElementById(picker);
                const hexEl = document.getElementById(hex);
                
                if (pickerEl && hexEl) {
                    pickerEl.addEventListener('input', (e) => {
                        hexEl.value = e.target.value;
                        updateLivePreview();
                    });
                    
                    hexEl.addEventListener('input', (e) => {
                        if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                            pickerEl.value = e.target.value;
                            updateLivePreview();
                        }
                    });
                }
            });

            // Theme preset buttons
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('preset-btn')) {
                    applyThemePreset(e.target.dataset.theme);
                }
            });

            // Branding actions
            const applyBtn = document.getElementById('apply-branding');
            const exportBtn = document.getElementById('export-theme');
            const resetBtn = document.getElementById('reset-branding');

            if (applyBtn) applyBtn.addEventListener('click', applyBrandingChanges);
            if (exportBtn) exportBtn.addEventListener('click', exportThemeConfig);
            if (resetBtn) resetBtn.addEventListener('click', resetToDefaultBranding);
        }

        function updateLivePreview() {
            const primaryColor = document.getElementById('primary-color').value;
            const bgColor = document.getElementById('bg-color').value;
            const textColor = document.getElementById('text-color').value;
            const brandName = document.getElementById('brand-name').value;
            const tagline = document.getElementById('brand-tagline').value;

            // Update preview elements
            const previewHeader = document.getElementById('preview-header');
            const previewTitle = document.getElementById('preview-title');
            const previewSubtitle = document.getElementById('preview-subtitle');

            if (previewHeader) {
                previewHeader.style.background = bgColor;
                previewHeader.style.color = textColor;
            }
            if (previewTitle) previewTitle.textContent = brandName;
            if (previewSubtitle) previewSubtitle.textContent = tagline;

            // Update preview button
            const previewBtn = document.querySelector('.preview-btn');
            if (previewBtn) {
                previewBtn.style.background = primaryColor;
                previewBtn.style.color = bgColor;
            }
        }

        function applyThemePreset(theme) {
            const presets = {
                dwc: { primary: '#00ff88', bg: '#0a0e1a', text: '#ffffff' },
                corporate: { primary: '#2563eb', bg: '#f8fafc', text: '#1e293b' },
                elegant: { primary: '#7c3aed', bg: '#faf7ff', text: '#374151' },
                modern: { primary: '#059669', bg: '#ecfdf5', text: '#065f46' }
            };

            const preset = presets[theme];
            if (preset) {
                document.getElementById('primary-color').value = preset.primary;
                document.getElementById('primary-hex').value = preset.primary;
                document.getElementById('bg-color').value = preset.bg;
                document.getElementById('bg-hex').value = preset.bg;
                document.getElementById('text-color').value = preset.text;
                document.getElementById('text-hex').value = preset.text;
                updateLivePreview();
            }
        }

        function applyBrandingChanges() {
            // Apply changes to actual platform
            const root = document.documentElement;
            root.style.setProperty('--accent', document.getElementById('primary-color').value);
            root.style.setProperty('--background', document.getElementById('bg-color').value);
            root.style.setProperty('--text-primary', document.getElementById('text-color').value);
            
            addActivityItem('🎨', 'Branding changes applied to platform', 'Just now');
        }

        function exportThemeConfig() {
            const config = {
                branding: {
                    companyName: document.getElementById('brand-name').value,
                    tagline: document.getElementById('brand-tagline').value,
                    domain: document.getElementById('brand-domain').value,
                    supportEmail: document.getElementById('support-email').value
                },
                theme: {
                    primaryColor: document.getElementById('primary-color').value,
                    backgroundColor: document.getElementById('bg-color').value,
                    textColor: document.getElementById('text-color').value
                },
                exportedAt: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'theme-config.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function resetToDefaultBranding() {
            document.getElementById('brand-name').value = 'DWC Systems';
            document.getElementById('brand-tagline').value = 'Intelligence Platform';
            document.getElementById('brand-domain').value = '';
            document.getElementById('support-email').value = '';
            applyThemePreset('dwc');
        }

        function initializeEmailCampaignBuilder() {
            // Template tab switching
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('template-tab')) {
                    switchTemplateTab(e.target.dataset.tab);
                }
            });

            // AI enhancement tools
            const aiTools = ['optimize-subject', 'personalize-content', 'improve-cta', 'a-b-test'];
            aiTools.forEach(toolId => {
                const btn = document.getElementById(toolId);
                if (btn) btn.addEventListener('click', () => handleAIEnhancement(toolId));
            });

            // Campaign actions
            const actions = [
                { id: 'save-template', handler: saveEmailTemplate },
                { id: 'test-send', handler: sendTestEmail },
                { id: 'schedule-campaign', handler: scheduleCampaign }
            ];

            actions.forEach(({ id, handler }) => {
                const btn = document.getElementById(id);
                if (btn) btn.addEventListener('click', handler);
            });
        }

        function switchTemplateTab(tab) {
            // Hide all panels
            document.querySelectorAll('.editor-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.querySelectorAll('.template-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected panel
            const panel = document.getElementById(`${tab}-editor`) || document.getElementById(`${tab}-panel`);
            if (panel) panel.classList.add('active');
            
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');

            // Update preview if switching to preview tab
            if (tab === 'preview') {
                updateEmailPreview();
            }
        }

        function updateEmailPreview() {
            const htmlContent = document.getElementById('html-code').value;
            const iframe = document.getElementById('email-preview');
            if (iframe) {
                const doc = iframe.contentDocument || iframe.contentWindow.document;
                doc.open();
                doc.write(htmlContent);
                doc.close();
            }
        }

        function handleAIEnhancement(tool) {
            const enhancements = {
                'optimize-subject': 'Subject line optimized for 40% higher open rates',
                'personalize-content': 'Content personalized based on lead data and QNIS scores',
                'improve-cta': 'Call-to-action optimized for maximum conversion',
                'a-b-test': 'A/B test variants generated with different messaging approaches'
            };

            addActivityItem('🤖', enhancements[tool], 'Just now');
        }

        function saveEmailTemplate() {
            const templateData = {
                name: document.getElementById('campaign-name').value,
                type: document.getElementById('campaign-type').value,
                htmlContent: document.getElementById('html-code').value,
                savedAt: new Date().toISOString()
            };

            localStorage.setItem('email-templates', JSON.stringify(templateData));
            addActivityItem('💾', 'Email template saved successfully', 'Just now');
        }

        function sendTestEmail() {
            const testEmail = prompt('Enter email address for test send:');
            if (testEmail) {
                addActivityItem('📧', `Test email sent to ${testEmail}`, 'Just now');
            }
        }

        function scheduleCampaign() {
            const campaignName = document.getElementById('campaign-name').value;
            if (!campaignName) {
                alert('Please enter a campaign name before scheduling.');
                return;
            }

            addActivityItem('📅', `Campaign "${campaignName}" scheduled successfully`, 'Just now');
        }

        function initializePricingPlans() {
            // Make pricing cards interactive
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('pricing-btn')) {
                    handlePlanSelection(e.target);
                }
            });
        }

        function handlePlanSelection(button) {
            const card = button.closest('.pricing-card');
            const planName = card.querySelector('h4').textContent;
            addActivityItem('💳', `${planName} plan selected for evaluation`, 'Just now');
        }

        // Developer Tools Initialization
        function initializeDeveloperTools() {
            initializeLogsViewer();
            initializeThemeCustomizer();
            initializeModuleLoader();
        }

        function initializeLogsViewer() {
            const logFilters = document.getElementById('log-level');
            const sourceFilter = document.getElementById('log-source');
            const clearBtn = document.getElementById('clear-logs');
            const exportBtn = document.getElementById('export-logs');

            if (logFilters) logFilters.addEventListener('change', filterLogs);
            if (sourceFilter) sourceFilter.addEventListener('change', filterLogs);
            if (clearBtn) clearBtn.addEventListener('click', clearAllLogs);
            if (exportBtn) exportBtn.addEventListener('click', exportLogs);

            // Start real-time log monitoring
            startLogMonitoring();
        }

        function startLogMonitoring() {
            // Monitor console logs and add to display
            const originalLog = console.log;
            const originalError = console.error;
            const originalWarn = console.warn;

            console.log = function(...args) {
                addLogEntry('info', args.join(' '));
                originalLog.apply(console, args);
            };

            console.error = function(...args) {
                addLogEntry('error', args.join(' '));
                originalError.apply(console, args);
            };

            console.warn = function(...args) {
                addLogEntry('warn', args.join(' '));
                originalWarn.apply(console, args);
            };
        }

        function addLogEntry(level, message) {
            const clientLogs = document.getElementById('client-logs');
            if (!clientLogs) return;

            const entry = document.createElement('div');
            entry.className = `log-entry ${level}`;
            entry.innerHTML = `
                <span class="log-time">[${new Date().toLocaleTimeString()}]</span>
                <span class="log-level">[${level.toUpperCase()}]</span>
                <span class="log-message">${message}</span>
            `;

            clientLogs.insertBefore(entry, clientLogs.firstChild);

            // Update counters
            updateLogCounters();

            // Keep only latest 100 entries
            if (clientLogs.children.length > 100) {
                clientLogs.removeChild(clientLogs.lastChild);
            }
        }

        function updateLogCounters() {
            const totalLogs = document.querySelectorAll('.log-entry').length;
            const errorCount = document.querySelectorAll('.log-entry.error').length;
            const warningCount = document.querySelectorAll('.log-entry.warn').length;

            if (document.getElementById('total-logs')) document.getElementById('total-logs').textContent = totalLogs;
            if (document.getElementById('error-count')) document.getElementById('error-count').textContent = errorCount;
            if (document.getElementById('warning-count')) document.getElementById('warning-count').textContent = warningCount;
        }

        function filterLogs() {
            const level = document.getElementById('log-level').value;
            const source = document.getElementById('log-source').value;
            
            document.querySelectorAll('.log-entry').forEach(entry => {
                let show = true;
                
                if (level !== 'all' && !entry.classList.contains(level)) {
                    show = false;
                }
                
                entry.style.display = show ? 'block' : 'none';
            });
        }

        function clearAllLogs() {
            if (document.getElementById('client-logs')) document.getElementById('client-logs').innerHTML = '';
            if (document.getElementById('server-logs')) document.getElementById('server-logs').innerHTML = '';
            updateLogCounters();
        }

        function exportLogs() {
            const logs = Array.from(document.querySelectorAll('.log-entry')).map(entry => {
                return entry.textContent;
            }).join('\n');

            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'system-logs.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        function initializeThemeCustomizer() {
            // Category switching
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('category-btn')) {
                    switchStyleCategory(e.target.dataset.category);
                }
            });

            // Theme actions
            const actions = [
                { id: 'apply-theme', handler: applyThemeChanges },
                { id: 'save-theme', handler: saveThemeConfiguration },
                { id: 'reset-theme', handler: resetToDefaultTheme },
                { id: 'export-css', handler: exportCustomCSS }
            ];

            actions.forEach(({ id, handler }) => {
                const btn = document.getElementById(id);
                if (btn) btn.addEventListener('click', handler);
            });

            // Real-time preview updates
            const controls = ['primary-color-picker', 'secondary-color-picker', 'bg-color-picker', 'text-color-picker'];
            controls.forEach(id => {
                const control = document.getElementById(id);
                if (control) control.addEventListener('input', updateThemePreview);
            });
        }

        function switchStyleCategory(category) {
            document.querySelectorAll('.control-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            const targetSection = document.getElementById(`${category}-section`);
            if (targetSection) targetSection.classList.add('active');
            
            const targetBtn = document.querySelector(`[data-category="${category}"]`);
            if (targetBtn) targetBtn.classList.add('active');
        }

        function updateThemePreview() {
            const primaryColor = document.getElementById('primary-color-picker')?.value || '#00ff88';
            const bgColor = document.getElementById('bg-color-picker')?.value || '#0a0e1a';
            const textColor = document.getElementById('text-color-picker')?.value || '#ffffff';

            const preview = document.querySelector('.preview-viewport');
            if (preview) {
                preview.style.setProperty('--preview-primary', primaryColor);
                preview.style.setProperty('--preview-bg', bgColor);
                preview.style.setProperty('--preview-text', textColor);
            }
        }

        function applyThemeChanges() {
            updateThemePreview();
            addActivityItem('🎨', 'Theme changes applied to platform', 'Just now');
        }

        function saveThemeConfiguration() {
            const config = {
                colors: {
                    primary: document.getElementById('primary-color-picker')?.value || '#00ff88',
                    secondary: document.getElementById('secondary-color-picker')?.value || '#1e3a8a',
                    background: document.getElementById('bg-color-picker')?.value || '#0a0e1a',
                    text: document.getElementById('text-color-picker')?.value || '#ffffff'
                },
                savedAt: new Date().toISOString()
            };

            localStorage.setItem('theme-config', JSON.stringify(config));
            addActivityItem('💾', 'Theme configuration saved', 'Just now');
        }

        function resetToDefaultTheme() {
            if (document.getElementById('primary-color-picker')) document.getElementById('primary-color-picker').value = '#00ff88';
            if (document.getElementById('secondary-color-picker')) document.getElementById('secondary-color-picker').value = '#1e3a8a';
            if (document.getElementById('bg-color-picker')) document.getElementById('bg-color-picker').value = '#0a0e1a';
            if (document.getElementById('text-color-picker')) document.getElementById('text-color-picker').value = '#ffffff';
            updateThemePreview();
        }

        function exportCustomCSS() {
            const css = `
:root {
    --primary: ${document.getElementById('primary-color-picker')?.value || '#00ff88'};
    --secondary: ${document.getElementById('secondary-color-picker')?.value || '#1e3a8a'};
    --background: ${document.getElementById('bg-color-picker')?.value || '#0a0e1a'};
    --text: ${document.getElementById('text-color-picker')?.value || '#ffffff'};
}
            `;

            const blob = new Blob([css], { type: 'text/css' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'custom-theme.css';
            a.click();
            URL.revokeObjectURL(url);
        }

        function initializeModuleLoader() {
            // Module toggling
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('module-toggle')) {
                    toggleModule(e.target);
                }
                if (e.target.classList.contains('module-config')) {
                    configureModule(e.target);
                }
                if (e.target.classList.contains('category-btn') && e.target.dataset.category) {
                    filterModulesByCategory(e.target.dataset.category);
                }
            });
        }

        function toggleModule(button) {
            const card = button.closest('.module-card');
            const moduleName = card.querySelector('h4').textContent;
            const action = button.dataset.action;

            if (action === 'enable') {
                card.classList.remove('available');
                card.classList.add('active');
                button.textContent = 'Disable';
                button.dataset.action = 'disable';
                card.querySelector('.module-status').textContent = 'Active';
                card.querySelector('.module-status').className = 'module-status active';
                addActivityItem('🔌', `${moduleName} module enabled`, 'Just now');
            } else {
                card.classList.remove('active');
                card.classList.add('available');
                button.textContent = 'Enable';
                button.dataset.action = 'enable';
                card.querySelector('.module-status').textContent = 'Available';
                card.querySelector('.module-status').className = 'module-status available';
                addActivityItem('🔌', `${moduleName} module disabled`, 'Just now');
            }

            updateModuleStats();
        }

        function configureModule(button) {
            const card = button.closest('.module-card');
            const moduleName = card.querySelector('h4').textContent;
            addActivityItem('⚙️', `${moduleName} configuration opened`, 'Just now');
        }

        function filterModulesByCategory(category) {
            document.querySelectorAll('.module-card').forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });

            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const targetBtn = document.querySelector(`[data-category="${category}"]`);
            if (targetBtn) targetBtn.classList.add('active');
        }

        function updateModuleStats() {
            const activeCount = document.querySelectorAll('.module-card.active').length;
            const availableCount = document.querySelectorAll('.module-card.available').length;
            const customCount = 0; // Would be tracked separately

            if (document.getElementById('active-modules')) document.getElementById('active-modules').textContent = activeCount;
            if (document.getElementById('available-modules')) document.getElementById('available-modules').textContent = availableCount;
            if (document.getElementById('custom-modules')) document.getElementById('custom-modules').textContent = customCount;
        }
    </script>
</body>
</html>